<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>扶贫基地</title>
    <link href="/css/hjia/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="/css/hjia/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="/css/hjia/animate.min.css" rel="stylesheet">
    <link href="/css/hjia/style.min.css?v=4.1.0" rel="stylesheet">
    <link href="/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="/js/ztree/css/zTreeStyle.css" rel="stylesheet">
    <link href="/css/plugins/dataTables/dataTables.bootstrap.css" type="text/css" rel="stylesheet">

    <script src="/js/hjia/jquery.min.js?v=2.1.4"></script>
    <script src="/js/hjia/bootstrap.min.js?v=3.3.6"></script>
    <script src="/js/hjia/content.min.js?v=1.0.0"></script>

    <script src="/js/ztree/jquery.ztree.core.js"></script>
    <script src="/js/ztree/jquery.ztree.excheck.js"></script>
    <script src="/js/ztree/jquery.ztree.exedit.js"></script>

    <script src="/js/hjia/plugins/jeditable/jquery.jeditable.js"></script>
    <script src="/js/hjia/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="/js/hjia/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="/js/hjia/content.min.js?v=1.0.0"></script>
    <script src="/js/hjia/plugins/layer/layer.min.js"></script>
    <script src="/js/hjia/demo/layer-demo.min.js"></script>
    <script src="/js/hjia/plugins/validate/jquery.validate.min.js"></script>
    <script src="/js/hjia/plugins/validate/messages_zh.min.js"></script>
    <script src="/js/hjia/demo/form-validate-demo.min.js"></script>
    <script src="/js/hjia/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="/js/hjia/plugins/layer/laydate/laydate.js"></script>


    <style>
        .col-lable2{width: 12%}
        .col-lable3{width: 21%}
        .col-lable4{width: 23%}
        .col-lable5{width: 73%}
        .form-group{
            margin-bottom: 0px;
        }
    </style>

</head>

<body class="gray-bg">
<div class="">
    <div class="row">
        <div class="col-sm-3" style="padding-right: 2px;width:17%">
            <div class="ibox-content" id="ztree_div_div" style="overflow-y:auto;">
                <ul id="tree-div" class="ztree" style="overflow: auto;"></ul>
            </div>
        </div>
        <div class="col-sm-9 animated fadeInRight" style="padding-left: 15px;width:83%">
            <!--这是列表信息开始-->
            <div class="row">
                <div class="col-sm-13" style="margin-top: 0%;">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <div class="form-group">
                                <label class="col-sm-1 control-label" style="width: 7%">名称：</label>
                                <div class="col-sm-3" style="width: 20%;top: -7px; margin-left: -25px">
                                    <input id="pab003_scan" name="pab003_scan" placeholder="请输入扶贫基地名称..." type="text" class="form-control" required="" aria-required="true">
                                </div>
                                <label class="col-sm-1 control-label" style="width: 7%">年度：</label>
                                <div class="col-sm-3" style="width: 15%;top: -7px; margin-left: -25px">
                                    <input id="niandu" name="niandu" placeholder="请输入年度..."  type="text" class="form-control" required="" aria-required="true">
                                </div>
                                <label class="col-sm-1 control-label" style="width: 7%">级别：</label>
                                <div class="col-sm-3" style="width: 15%;top: -7px; margin-left: -25px">
                                    <select id="pab010_scan"  class="form-control" name="pab010_scan">
                                        <option value=''>-- 请选择 --</option>
                                    </select>
                                </div>
                                <label class="col-sm-1 control-label" style="width: 8%">苏陕协作：</label>
                                <div class="col-sm-3" style="width: 15%;top: -7px; margin-left: -25px">
                                    <select id="pab016_scan"  class="form-control" name="pab016_scan">
                                        <option value=''>-- 请选择 --</option>
                                    </select>
                                </div>
                            </div>
                            <a  href="javascript:void(0);" class="btn btn-primary " data-toggle="modal" data-target="#povertybaseadd" onclick="addPoverty()" style="float: right;margin-top: -1%; margin-right: 1%">添加</a>
                            <a  href="javascript:void(0);" class="btn btn-primary " onclick="searchInformation()" style="float: right;margin-top: -1%; margin-right: 1%">查询</a>
                        </div>
                        <div class="ibox-content" id="table_div">
                            <table class="table table-striped table-bordered table-hover " id="povertybase_table"><thead>
                            <tr>
                                <th>序号</th>
                                <th>操作</th>
                                <th>所属行政区</th>
                                <th>扶贫基地名称</th>
                                <th>级别</th>
                                <th>扶贫基地地址</th>
                                <th>从业人数</th>
                                <th>从业贫困劳动力数量</th>
                                <th>认定时间</th>
                                <th>注销时间</th>
                            </tr>
                            </thead></table><table>
                        </table>

                        </div>
                    </div>
                </div>
            </div>
            <!--这是列表信息结束-->
        </div>
    </div>
</div>

<!--模态窗口  扶贫基地信息  div-->
<div class="modal inmodal" id="povertybaseadd" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="margin:auto;width:100%">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header" style="padding: 10px 15px;text-align: left">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
                </button>
                <h6 id="povertybase_head" class="modal-title" style="font-size:16px">新增扶贫基地信息</h6>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="povertybaseForm" action="#" method="post">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">所属行政区划：<span style="color: red">*</span></label>
                        <div class="col-sm-9 col-lable5">
                            <input id="aab301_id" name="aab301_id"  readonly="readonly"  type="text" class="form-control" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">扶贫基地名称：<span style="color: red">*</span></label>
                        <input id="pab001" name="pab001"  type="hidden" >
                        <input id="aab301" name="aab301" type="hidden">
                        <div class="col-sm-9 col-lable5">
                            <input id="pab003" name="pab003" placeholder="请输入扶贫基地名称..." type="text" class="form-control" required="" aria-required="true">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">扶贫基地地址：<span style="color: red">*</span></label>
                        <div class="col-sm-9 col-lable5">
                            <input id="pab004" name="pab004" placeholder="请输入扶贫基地地址..." type="text" class="form-control" required="" aria-required="true">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">易地扶贫搬迁：<span style="color: red">*</span></label>
                        <div class="col-sm-3">
                            <select id="pab014" class="form-control" name="pab014" onchange="changeCtf015(this.value)">
                                <option value=''>-- 请选择 --</option>
                            </select>
                        </div>
                        <label class="col-sm-2 control-label col-lable4">安置点名称：<span id="show_ctf004" style="color: red;display: none">*</span></label>
                        <div class="col-sm-3">
                            <select id="pab013" name="pab013" class="form-control" >
                                <option value=''>-- 请选择 --</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">从业人数：<span style="color: red">*</span></label>
                        <div class="col-sm-2">
                            <input id="pab007" name="pab007" placeholder="请输入从业人数..." type="number" class="form-control" required="" aria-required="true">
                        </div>

                        <label class="col-sm-2 control-label">级别：<span style="color: red">*</span></label>
                        <div class="col-sm-2">
                            <select id="pab010"  class="form-control" name="pab010">
                                <option value=''>-- 请选择 --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                       <!-- <label class="col-sm-2 control-label">享受以工代训补贴：<span style="color: red">*</span></label>
                        <div class="col-sm-2">
                            <input id="pab011" name="pab011" placeholder="享受以工代训补贴..." type="number" class="form-control" required="" aria-required="true">
                        </div>
                        <label class="col-sm-2" style="margin-top: 1%;margin-left: -8.4%">元</label>
                        <label class="col-sm-1 control-label" style="margin-left: -2%">享受奖补资金：<span style="color: red">*</span></label>
                        <div class="col-sm-2">
                            <input id="pab012" name="pab012" placeholder="享受奖补资金..."  type="number" class="form-control" required="" aria-required="true">
                        </div>
                        <label class="col-sm-2" style="margin-top: 1%;margin-left: -8.4%">元</label>-->
                        <label class="col-sm-2 control-label" >认定时间：<span style="color: red">*</span></label>
                        <div class="col-sm-2">
                            <input id="pab005" name="pab005" placeholder="请输入认定时间..."  type="text" class="laydate-icon form-control layer-date" required="" aria-required="true">
                        </div>
                        <label class="col-sm-2 control-label" >注销时间：</label>
                        <div class="col-sm-2">
                            <input id="pab006" name="pab006" placeholder="请输入注销时间..."  type="text" class="laydate-icon form-control layer-date" required="" aria-required="true">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">苏陕协作：<span style="color: red">*</span></label>
                        <div class="col-sm-2">
                            <select id="pab016"  class="form-control" name="pab016">
                                <option value=''>-- 请选择 --</option>
                            </select>
                        </div>
                        <label class="col-sm-2 control-label">备注：</label>
                        <div class="col-sm-2">
                            <input id="pab009" name="pab009" placeholder="请输入备注..."  type="text" class="form-control" required="" aria-required="true">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="savePovertyBase()">保存</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <button type="button" class="btn btn-white" onclick="cleaninput('qingkong')">清空</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <span id="add_worker_span" style="display: none">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#workeradd" onclick="addWorker()">添加劳动力</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#subsibyadd" onclick="addSubsiby()">添加享受政策</button>&nbsp;&nbsp;&nbsp;&nbsp;
                        </span>
                    </div>
                </form>

                <div class="col-sm-16" id="tab_connect_div">
                    <div class="tabs-container">
                        <ul class="nav nav-tabs" id="myTab">
                            <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true">贫困劳动力信息</a>
                            </li>
                            <li class=""><a data-toggle="tab" href="#tab-2" aria-expanded="false">享受政策</a>
                            </li>

                        </ul>
                        <div class="tab-content">
                            <div id="tab-1" class="tab-pane active">
                                <!--创业带头人 table 开始-->
                                <div class="ibox-content" style="padding:0">
                                    <table class="table table-striped table-bordered table-hover " id="worker_table"><thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>劳动力姓名</th>
                                        <th>证件号码</th>
                                        <th>性别</th>
                                        <th>年龄</th>
                                        <th>上岗年月</th>
                                        <th>合同或者协议签订(月)</th>
                                        <th>月工资(元)</th>
                                        <th>家庭住址</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead></table><table>
                                </table>
                                </div>
                                <!--创业带头人table 结束-->
                            </div>
                            <div id="tab-2" class="tab-pane">
                                <!--劳务经济人 信息table 开始-->
                                <div class="ibox-content" style="padding:0">
                                    <table class="table table-striped table-bordered table-hover " id="subsiby_table"><thead>
                                    <tr>
                                        <th>年度</th>
                                        <th>以工代训补贴</th>
                                        <th>一次性奖补资金</th>
                                        <th>奖补性职业介绍补贴</th>
                                        <th>享受人数</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead></table><table>
                                </table>
                                </div>
                                <!--劳务经济人 table 结束-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        </div>
        </div>
    </div>
</div>



<div class="modal inmodal" id="workeradd" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="margin:auto;width:90%">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header" style="padding: 10px 15px;text-align: left">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
                </button>
                <h6 id="workeradd_head" class="modal-title" style="font-size:16px">贫困劳动力信息</h6>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="workerForm" action="#" method="post">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">身份证号：<span style="color: red">*</span></label>
                        <input id="companyid" name="companyid"  type="hidden" >
                        <input id="aab301_a" name="aab301_a"  type="hidden" >

                        <div class="col-sm-3 col-lable3">
                            <input id="aac002" name="aac002"  onchange="countPlf005(this.value)" placeholder="请输入身份证号..." type="text" class="form-control" >
                        </div>
                        <label class="col-sm-2 control-label col-lable4">姓名：<span style="color: red">*</span></label>
                        <div class="col-sm-3 col-lable3">
                            <input id="rtn001" name="rtn001"  type="hidden" >
                            <input id="type" name="type" value="2"  type="hidden" >
                            <input id="aac003" readonly="readonly" name="aac003" placeholder="请输入劳动力姓名..."  type="text" class="form-control" >
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">性别：</label>
                        <div class="col-sm-3 col-lable3">
                            <select id="aac004"  class="form-control" name="aac004" readonly="readonly"></select>
                        </div>
                        <label class="col-sm-2 control-label col-lable4">年龄：</label>
                        <div class="col-sm-3 col-lable3">
                            <input id="aac006"  class="form-control" name="aac006" readonly="readonly">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">签订合同或协议：<span style="color: red">*</span></label>
                        <div class="col-sm-3 col-lable3">
                            <input id="rtn004" name="rtn004" placeholder="签订合同或协议..."   type="number" class="form-control" >
                        </div>
                        <label class="col-sm-2" style="margin-top: 1%;margin-left: -10.4%">个月</label>
                        <label class="col-sm-2 control-label ">月工资(元)：<span style="color: red">*</span></label>
                        <div class="col-sm-3 col-lable3">
                            <input id="rtn006" name="rtn006" placeholder="月工资..."   type="number" class="form-control" >
                        </div>
                        <label class="col-sm-2" style="margin-top: 1%;margin-left: -10%">元</label>
                    </div>
                    <div class="form-group">

                        <label class="col-sm-2 control-label">上岗年月：<span style="color: red">*</span></label>
                        <div class="col-sm-3 col-lable3">
                            <input id="rtn003" name="rtn003" placeholder="请输入上岗年月..." onchange="queryWorkerByIdCard()"  type="text" class="laydate-icon form-control layer-date" required="" aria-required="true">
                        </div>

                        <label class="col-sm-2 control-label col-lable4">离职年月：</label>
                        <div class="col-sm-3 col-lable3 ">
                            <input id="rtn005" name="rtn005" placeholder="请输入上岗年月..."  type="text" class="laydate-icon form-control layer-date" required="" aria-required="true">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">家庭住址：<span style="color: red">*</span></label>
                        <div class="col-sm-7" style="width:65%;">
                            <input id="rtn002" name="rtn002" placeholder="家庭住址..."  type="text" class="form-control" >
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="text-align: center">
                <button type="button" class="btn btn-primary" onclick="saveWorker()">保存</button>&nbsp;&nbsp;&nbsp;
                <button type="button" class="btn btn-white" onclick="cleaninput_worker('qingkong')">清空</button>
            </div>
        </div>
    </div>
</div>


<!--添加享受政策-->
<div class="modal inmodal" id="subsibyadd" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="margin:auto;width:70%">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header" style="padding: 10px 15px;text-align: left">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
                </button>
                <h6 id="subsibyadd_head" class="modal-title" style="font-size:16px">添加享受政策</h6>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="subsibyForm" action="#" method="post">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">以工代训补贴：<span style="color: red">*</span></label>
                        <div class="col-sm-3">
                            <input id="eps001" name="eps001"  type="hidden" >
                            <input id="eps002" name="eps002" value="1"  type="hidden" >
                            <input id="eps005" name="eps005" placeholder="以工代训补贴..."  type="number" class="form-control" required="" aria-required="true">
                        </div>
                        <label class="col-sm-2" style="margin-top: 1%;margin-left: -10%">元</label>
                        <label class="col-sm-2 control-label ">一次性奖补资金：<span style="color: red">*</span></label>
                        <div class="col-sm-3">
                            <input id="eps006" name="eps006" placeholder="一次性奖补资金..."  type="number" class="form-control" required="" aria-required="true">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">享受人数：<span style="color: red">*</span></label>
                        <div class="col-sm-3">
                            <input id="eps008" name="eps008" placeholder="享受人数..."  type="number" class="form-control" required="" aria-required="true">
                        </div>
                        <label class="col-sm-2 control-label ">补贴年度：<span style="color: red">*</span></label>
                        <div class="col-sm-3">
                            <select id="eps004" class="form-control" name="eps004">
                                <option value=''>-- 请选择 --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">奖补性职业介绍补贴：<span style="color: red">*</span></label>
                        <div class="col-sm-4">
                            <input id="eps007" name="eps007" placeholder="奖补性职业介绍补贴..."  type="number" class="form-control" required="" aria-required="true">
                        </div>
                        <label class="col-sm-2" style="margin-top: 1%;margin-left: -10%">元</label>
                    </div>

                </form>
            </div>
            <div class="modal-footer" style="text-align: center">
                <button type="button" class="btn btn-primary" onclick="saveSubsiby()">保存</button>&nbsp;&nbsp;&nbsp;
                <button type="button" class="btn btn-white" onclick="cleaninput_subsiby('save')">清空</button>
            </div>
        </div>
    </div>
</div>
<!--添加享受政策-->

<!--等待的模态框  和等待特效-->
<div class="modal inmodal fade" id="loading_div" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-sm">
        <div class="scene">
            <svg style="width: 200px;height: 200px;"
                 version="1.1"
                 id="dc-spinner"
                 xmlns="http://www.w3.org/2000/svg"
                 x="0px" y="0px"
                 viewBox="0 0 38 38"
                 preserveAspectRatio="xMinYMin meet"
            >
                <text x="14" y="21" font-family="Monaco" font-size="2px" style="letter-spacing:0.6" fill="yellow">LOADING
                    <animate
                            attributeName="opacity"
                            values="0;1;0" dur="1.8s"
                            repeatCount="indefinite"/>
                </text>
                <path fill="#373a42" d="M20,35c-8.271,0-15-6.729-15-15S11.729,5,20,5s15,6.729,15,15S28.271,35,20,35z M20,5.203
    C11.841,5.203,5.203,11.841,5.203,20c0,8.159,6.638,14.797,14.797,14.797S34.797,28.159,34.797,20
    C34.797,11.841,28.159,5.203,20,5.203z">
                </path>

                <path fill="#373a42" d="M20,33.125c-7.237,0-13.125-5.888-13.125-13.125S12.763,6.875,20,6.875S33.125,12.763,33.125,20
    S27.237,33.125,20,33.125z M20,7.078C12.875,7.078,7.078,12.875,7.078,20c0,7.125,5.797,12.922,12.922,12.922
    S32.922,27.125,32.922,20C32.922,12.875,27.125,7.078,20,7.078z">
                </path>

                <path fill="#2AA198" stroke="#2AA198" stroke-width="0.6027" stroke-miterlimit="10" d="M5.203,20
			c0-8.159,6.638-14.797,14.797-14.797V5C11.729,5,5,11.729,5,20s6.729,15,15,15v-0.203C11.841,34.797,5.203,28.159,5.203,20z">
                    <animateTransform
                            attributeName="transform"
                            type="rotate"
                            from="0 20 20"
                            to="360 20 20"
                            calcMode="spline"
                            keySplines="0.4, 0, 0.2, 1"
                            keyTimes="0;1"
                            dur="2s"
                            repeatCount="indefinite" />
                </path>

                <path fill="#859900" stroke="#859900" stroke-width="0.2027" stroke-miterlimit="10" d="M7.078,20
  c0-7.125,5.797-12.922,12.922-12.922V6.875C12.763,6.875,6.875,12.763,6.875,20S12.763,33.125,20,33.125v-0.203
  C12.875,32.922,7.078,27.125,7.078,20z">
                    <animateTransform
                            attributeName="transform"
                            type="rotate"
                            from="0 20 20"
                            to="360 20 20"
                            dur="1.8s"
                            repeatCount="indefinite" />
                </path>
            </svg>
        </div>
    </div>
</div>


<script>
    var lang;
    var povertybase_datatable;
    var worker_datatable;
    $(function () {
        //设置树的高度
        $("#ztree_div_div").css({"height":$(window).height()});
        $("#table_div").css({"height":$(window).height()-70});
        //设置div高度
        $("#ceshi_many").css("height", $("#workeradd").height() - 260);
        //日期控件
        laydate({
            elem: '#pab005', //对应id
            format: 'YYYY-MM-DD', //日期格式 // 分隔符可以任意定义，该例子表示只显示年月
            min: '1900-01-01', //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            festival: true, //显示节日
            istime: false,   //是否显示时分秒
            istoday: true, //是否是今天
            choose: function(datas){ //选择日期完毕的回调
               /* end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日*/
            }
        });
        laydate({
            elem: '#pab006', //对应id
            format: 'YYYY-MM-DD', //日期格式 // 分隔符可以任意定义，该例子表示只显示年月
            min: '1900-01-01', //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            festival: true, //显示节日
            istime: false,   //是否显示时分秒
            istoday: true, //是否是今天
            choose: function(datas){ //选择日期完毕的回调
                /* end.min = datas; //开始日选好后，重置结束日的最小日期
                 end.start = datas //将结束日的初始值设定为开始日*/
            }
        });
        //日期控件
        laydate({
            elem: '#rtn005', //对应id
            format: 'YYYY-MM', //日期格式 // 分隔符可以任意定义，该例子表示只显示年月
            min: '1900-01-01', //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            festival: true, //显示节日
            istime: false,   //是否显示时分秒
            istoday: true, //是否是今天
            choose: function(datas){ //选择日期完毕的回调
                end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日
            }
        });
        //日期控件
        laydate({
            elem: '#rtn003', //对应id
            format: 'YYYY-MM', //日期格式 // 分隔符可以任意定义，该例子表示只显示年月
            min: '1900-01-01', //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            festival: true, //显示节日
            istime: false,   //是否显示时分秒
            istoday: true, //是否是今天
            choose: function(datas){ //选择日期完毕的回调
                /*end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日*/
                queryWorkerByIdCard();
            }
        });
       /* laydate({
            elem: '#pab006', //对应id
            format: 'YYYY-MM-DD', //日期格式 // 分隔符可以任意定义，该例子表示只显示年月
            min: '1900-01-01', //设定最小日期为当前日期
            max: '2099-06-16', //最大日期
            festival: true, //显示节日
            istime: false,   //是否显示时分秒
            istoday: true, //是否是今天
            choose: function(datas){ //选择日期完毕的回调
                end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日
            }
        });*/

        //点击叉号调用的事件
        $('#povertybaseadd').on('hide.bs.modal', function () {
            cleaninput('saveorupdate');
            $("#add_worker_span").hide();//隐藏添加劳动力的按钮
        });

        //点击叉号调用的事件
        $('#workeradd').on('hide.bs.modal', function () {
            cleaninput_worker('saveorupdate');
        });

        //点击叉号调用的事件
        $('#subsibyadd').on('hide.bs.modal', function () {
            cleaninput_subsiby('saveorupdate');
        });

        //树节点的初始化事件
        $.fn.zTree.init($("#tree-div"), sys_perm_setting);

        //queryParam('AAA009','pab010');//级别
       // queryParam('AAA009','pab010_scan');//查询条件中的级别
        //queryParam('AAC004','aac004');//查询条件中的级别
        queryAllAa10list();

        //提示信息  初始化设置 一般不需要改
        lang = {
            "sProcessing": "处理中...",
            "sLengthMenu": "每页 _MENU_ 项",
            "sZeroRecords": "没有匹配结果",
            "sInfo": "当前显示第 _START_ 至 _END_ 项，共 _TOTAL_ 项。",
            "sInfoEmpty": "当前显示第 0 至 0 项，共 0 项",
            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            "sInfoPostFix": "",
            "sSearch": "搜索:",
            "sUrl": "",
            "sEmptyTable": "表中数据为空",
            "sLoadingRecords": "载入中...",
            "sInfoThousands": ",",
            "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "上页",
                "sNext": "下页",
                "sLast": "末页",
                "sJump": "跳转"
            },
            "oAria": {
                "sSortAscending": ": 以升序排列此列",
                "sSortDescending": ": 以降序排列此列"
            }
        };





    })

    //树配置
    var sys_perm_setting = {
        edit: {
            drag:{
                prev: true,
                next: true,
                inner:true
            },
            enable: true,
            showRemoveBtn: false,
            showRenameBtn: false
        },
        view: {
            showLine: true,
            nameIsHTML: true
        },
        check: {
            enable: false,
            chkboxType:  { "Y": "s", "N": "s" } //chkboxType: { “Y”: “ps”, “N”: “ps” } Y 属性定义 checkbox 被勾选后的情况;N 属性定义 checkbox 取消勾选后的情况;“p” 表示操作会影响父级节点;“s” 表示操作会影响子级节点;请注意大小写，不要改变
        },
        data: {
            simpleData: {
                enable: true,
                pIdKey: "parentid"
            }
        },
        callback: {
            onClick: onClick,
            onAsyncSuccess:getTreeFirstNodeId
        },
        async: {
            enable: true,
            url:"/ztree/treedata",
            autoParam:["groupid"]
        }
    };

//树节点的点击事件
    function onClick (event, treeId, treeNode, clickFlag) {
        $("#aab301").val(treeNode.groupid);
        $("#aab301_a").val(treeNode.groupid);
        searchInformation();
       // queryCentralizedSettlements();
    }

    var treetype;         // 获取登录用户级别   树默认展开第一级节点
    function getTreeFirstNodeId(){
        var treeObj = $.fn.zTree.getZTreeObj("tree-div");
        var nodes = treeObj.getNodes();
        var firstNode = nodes[0];
        treeObj.expandNode(nodes[0], true);  treetype = firstNode.type;
        $("#aab301").val(firstNode.groupid);
        $("#aab301_a").val(firstNode.groupid);
       // queryCentralizedSettlements();
    }


    //加载扶贫基地
    function loadPovertyBase(){
        //重要修改 表格内容的自定义，需要根据业务定制
        povertybase_datatable = $("#povertybase_table").dataTable({
            language:lang,  //提示信息
            autoWidth: true,  //禁用自动调整列宽
            ordering:false,//禁止排序
            scrollY:$(window).height()-170,//表窗口高度-
            scrollX:$(window).width(),
            destroy: true,
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: false,  //隐藏加载提示,自行处理
            serverSide: true,  //启用服务器端分页
            bLengthChange:false,//去掉下面的没有多少条
            aLengthMenu:[50,100],  //用户可自选每页展示数量 5条或10条
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            columnDefs: [{
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {
                $("#loading_div").modal('show');
                //封装请求参数
                var param = {};
                param.length= data.length;//页面显示记录条数，在页面显示每页显示多少项的时候
                param.start = data.start;//开始的记录序号
                param.pageIndex = (data.start / data.length);//当前页码
                param.pab003 = $("#pab003_scan").val();
                param.pab010 = $("#pab010_scan").val();
                param.pab016 = $("#pab016_scan").val();
                param.aab301 = $("#aab301").val();

                //ajax请求数据方法
                $.ajax({
                    type: "POST",
                    url: "/povertyBase/queryPovertyAlleviationBaseByAab301",//url请求的地址
                    cache: false,  //禁用缓存
                    data: param,  //传入组装的参数
                    dataType: "json",
                    success: function (result) {
                        //封装返回数据重要
                        var returnData = {};
                        //这里直接自行返回了draw计数器,应该由后台返回
                        //returnData.draw = data.draw;
                        //返回数据全部记录
                        returnData.recordsTotal = result.recordsTotal;
                        //后台不实现过滤功能，每次查询均视作全部结果
                        returnData.recordsFiltered = result.recordsFiltered;
                        //返回的数据列表
                        returnData.data = result.data;

                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                        $("#loading_div").modal('hide');
                    }
                });
            },
            //列表表头字段
            columns: [
                { "data": "rn","width":"40px" },
                {"data":"pab001","width":"120px","render":function(data, type, full, meta){
                    if(treetype <= 3){     //说明是区县以上用户登录的，则可以删除
                        return	data="<button onclick=\"updatePovertyBase('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#povertybaseadd' >修 改</button>   <button  class='btn btn-sm btn-danger btn-del' onclick=\"delFactory('"+data+"')\">删 除</button>  ";
                    }else{   //说明是区县一下人登录的，则只能修改
                         return	 data="<button onclick=\"updatePovertyBase('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#povertybaseadd' >修 改</button> ";
                    }
                    // return	data="<button onclick=\"updatePovertyBase('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#povertybaseadd' >修 改</button> ";
                    //return	data="<button onclick=\"updatePovertyBase('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#povertybaseadd' >修 改</button>   <button  class='btn btn-sm btn-danger btn-del' onclick=\"delFactory('"+data+"')\">删 除</button>  ";
                }},
                { "data": "aab301","width":"240px" },
                { "data": "pab003","width":"150px" },
                { "data": "pab010","width":"40px" },
                { "data": "pab004","width":"140px" },
                { "data": "pab007","width":"80px" },
                { "data": "pab008","width":"120px" },
                { "data": "pab005","width":"90px" },
                { "data": "pab006","width":"90px" }
            ]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }


    /**
     * 保存扶贫基地信息
     */
    function savePovertyBase(){
        if(checkAll() == 1){
            $.ajax({
                url:"/povertyBase/savePovertyBase",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:$('#povertybaseForm').serialize(),    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    // cleaninput('saveorupdate');//因为要添加劳动力，所以不能清空扶贫基地
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'update'){
                            povertybase_datatable.ajax.reload();
                            swal("修改成功！", "您已经成功修改了这条信息。", "success");
                        }else{
                            $("#add_worker_span").show();//展示出添加劳动力的按钮
                            $("#pab001").val(data);//将扶贫基地主键放在页面上
                            povertybase_datatable.ajax.reload();
                            swal("保存成功！", "您已经成功保存了这条信息。", "success");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });
        }
    }

    /**
     * 修改扶贫基地信息
     */
    function updatePovertyBase(id){
        queryCentralizedSettlements();
        $("#add_worker_span").show();//展示添加劳动力的按钮
        $("#povertybase_head").text("修改扶贫基地信息");
        $.ajax({
            url:"/povertyBase/updatePovertyBase",    //请求的url地址
            dataType:"json",   //返回格式为json
            async:false,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"pab001":id},    //参数值
            type:"POST",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                $("#pab001").val(data.pab001);
                $("#pab003").val(data.pab003);
                $("#pab004").val(data.pab004);
                $("#pab005").val(data.pab005);
                $("#pab006").val(data.pab006);
                $("#pab007").val(data.pab007);
                $("#pab009").val(data.pab009);
                $("#pab010").prop("value",data.pab010);
                $("#pab016").prop("value",data.pab016);
                $("#pab014").prop("value",data.pab014);
                $("#pab013").prop("value",data.pab013);
                $("#pab011").val(data.pab011);
                $("#pab012").val(data.pab012);
                $("#pab013").val(data.pab013);
                $("#aab301").val(data.aab301);
                if(data.pab001 != null &&  data.pab001 != ''){
                    loadWorker();//加载劳动力表格
                    loadSubsiby();//加载补贴信息
                }
                queryAab301Info(data.aab301,"aab301_id");
            },
            complete:function(){
            },
            error:function(){
                //请求出错处理
            }
        });
    }

    /**
     *删除扶贫基地信息
     */
    function delFactory(id){
        swal({
            title: "您确定要删除这条信息吗",
            text: "删除后将无法恢复，请谨慎操作！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText:"取消",
            confirmButtonText: "删除",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url:"/povertyBase/delPovertyBase",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:{"pab001":id},    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'yes'){
                            povertybase_datatable.ajax.reload();
                            swal("删除成功！", "您已经永久删除了这条信息。", "success");
                        }else if(data == 'no'){
                            swal("删除失败！", "您未删除这条信息。", "fail");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });

        });
    }


    /**
     * 查询参数，获取对应的下拉值
     */
    function queryParam(aaa100,id){
        $("#"+id).empty();
        $.ajax({
            url:"/aa10/queryAa10",    //请求的url地址
            dataType:"json",   //返回格式为json
            async:true,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"aaa100":aaa100},    //参数值
            type:"POST",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                //请求成功时处理
                if(data != null && data != undefined){
                    var options ="";
                    options +="<option value=''>-- 请选择 --</option>";
                    for(var i=0;i<data.length;i++){
                        options +="<option value='"+data[i].aaa102+"'>"+data[i].aaa103+"</option>";
                    }
                    $("#"+id).append(options);
                }
            },
            complete:function(){
                //请求完成的处理
            },
            error:function(){
                //请求出错处理
            }
        });
    }


    /**
     *输入条件进行查询
     */
    function searchInformation() {
        loadPovertyBase();
    }

    //清空的点击按钮
    function cleaninput(flag) {
        var pab001 = $("#pab001").val();
        var aab301 = $("#aab301").val();
        $("input").val('');
        $("#pab010").prop("value","");
        $("#pab016").prop("value","");
        if(flag !='saveorupdate'){
            if(pab001 != null && pab001 !=''){
                updatePovertyBase(pab001);
            }else{
            }
        }
        $("#aab301").val(aab301);
        queryAab301Info(aab301,"aab301_id");
    }


    //保存前校验必填项是否都填写
    function checkAll() {
        var pab003 = $("#pab003").val();
        var pab004 = $("#pab004").val();
        var pab005 = $("#pab005").val();
        var pab007 = $("#pab007").val();
        var pab010 = $("#pab010").val();
        var pab013 = $("#pab013").val();
        var pab014 = $("#pab014").val();
        var pab016 = $("#pab016").val();

        var flag = 0;
        if(pab003 =="" || pab003 == null){
            swal({
                title: "请输入扶贫基地名称!",
                text: "您好！扶贫基地名称不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(pab004 =="" || pab004 == null){
            swal({
                title: "请输入扶贫基地地址!",
                text: "您好！扶贫基地地址不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(pab005 =="" || pab005 == null){
            swal({
                title: "请输入认定时间!",
                text: "您好！认定时间不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(pab007 =="" || pab007 == null){
            swal({
                title: "请输入从业人数!",
                text: "您好！从业人数不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }

        if(pab010 =="" || pab010 == null){
            swal({
                title: "请输入级别!",
                text: "您好！级别不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(pab016 =="" || pab016 == null){
            swal({
                title: "请输入苏陕协作!",
                text: "您好！苏陕协作不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }

        if(pab014 =="" || pab014 == null){
            swal({
                title: "请输入是否易地扶贫搬迁!",
                text: "您好！是否易地扶贫搬迁不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }else{
            if(pab014 =="1"){
                if(pab013 =="" || pab013 == null){
                    swal({
                        title: "请选择安置点名称!",
                        text: "您好！安置点名称不能为空",
                        timer: 2000,
                        showConfirmButton: false
                    });
                    return flag;
                }
            }
        }

        flag = 1;
        return flag;
    }


</script>
<script>

    function loadWorker(){
//重要修改 表格内容的自定义，需要根据业务定制
        worker_datatable = $("#worker_table").dataTable({
                language:lang,  //提示信息
                autoWidth: false,  //禁用自动调整列宽
                ordering:false,//禁止排序
                scrollY:$(window).height()-430,//表窗口高度-100px
                destroy: true,
                stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
                processing: false,  //隐藏加载提示,自行处理
                serverSide: true,  //启用服务器端分页
                bLengthChange:false,//去掉下面的没有多少条
                aLengthMenu:[50,100],  //用户可自选每页展示数量 5条或10条
                searching: false,  //禁用原生搜索
                orderMulti: false,  //启用多列排序
                order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
                renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
                pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
                columnDefs: [{
                    "targets": 'nosort',  //列的样式名
                    "orderable": false    //包含上样式名‘nosort’的禁止排序
                }],
                ajax: function (data, callback, settings) {
                    $("#loading_div").modal('show');
                    //封装请求参数

                    var pab001 = $("#pab001").val();//贫困户model中的id
                    var param = {};
                    param.length= data.length;//页面显示记录条数，在页面显示每页显示多少项的时候
                    param.start = data.start;//开始的记录序号
                    param.pageIndex = (data.start / data.length);//当前页码
                    param.ctf001 = pab001;

                    //ajax请求数据方法
                    $.ajax({
                        type: "GET",
                        url: "/Relation/people",//url请求的地址
                        cache: false,  //禁用缓存
                        data: param,  //传入组装的参数
                        dataType: "json",
                        success: function (result) {
                            //封装返回数据重要
                            var returnData = {};
                            //这里直接自行返回了draw计数器,应该由后台返回
                            //returnData.draw = data.draw;
                            //返回数据全部记录
                            returnData.recordsTotal = result.recordsTotal;
                            //后台不实现过滤功能，每次查询均视作全部结果
                            returnData.recordsFiltered = result.recordsFiltered;
                            //返回的数据列表
                            returnData.data = result.data;

                            //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                            //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                            callback(returnData);
                            $("#loading_div").modal('hide');
                        }
                    });
                },
        //列表表头字段
        columns: [
            { "data": "rn" },
            { "data": "aac003" },
            { "data": "aac002" },
            { "data": "aac004" },
            { "data": "aac006" },
            { "data": "rtn003" },
            { "data": "rtn004" },
            { "data": "rtn006" },
            { "data": "rtn002" },
            {"data":"rtn001","width":"120px", "render":function(data, type, full, meta){
                    if(full.datasource == '1'){     //说明是录入数据可以删除
                        return	data="<button onclick=\"updateWorker('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#workeradd' >修 改</button> ";
                       // return	data="<button onclick=\"updateWorker('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#workeradd' >修 改</button>   <button  class='btn btn-sm btn-danger btn-del' onclick=\"delworker('"+data+"')\">删 除</button>  ";
                    }else{   //说明是导入数据，不能删除
                        return	data="<button onclick=\"updateWorker('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#workeradd' >修 改</button>  ";
                    }
                }}]
    }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }
    /**
     * 保存劳动力信息
     */
    function saveWorker(){
        var aab301 = $("#aab301").val();
        $("#aab301_a").val(aab301)
        if(checkAll_worker() == 1){
            $.ajax({
                url:"/Relation/people",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:$('#workerForm').serialize(),    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        cleaninput_worker('saveorupdate');

                        if(data == 'update'){
                            //请求完成的处理
                            loadWorker();
                            swal("修改成功！", "您已经成功修改了这条信息。", "success");
                        }else{  //说明是新增
                            //请求完成的处理
                            loadWorker();
                            swal("保存成功！", "您已经成功保存了这条信息。", "success");
                        }
                    }
                },
                complete:function(){
                    $("#aac002").removeAttrs("readOnly");
                },
                error:function(){
                    //请求出错处理
                }
            });
        }

    }

    /**
     * 修改劳动力信息
     */
    function updateWorker(id){

        //点击修改劳动力信息时，加载该劳动力下的所有表格
        $("#workeradd_head").text("修改劳动力信息");
        $.ajax({
            url:"/Relation/people",    //请求的url地址
            dataType:"json",   //返回格式为json
            async:false,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"rtn001":id},    //参数值
            type:"PUT",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                $("#rtn001").val(data.rtn001);
                $("#rtn002").val(data.rtn002);
                $("#rtn003").val(data.rtn003);
                $("#rtn004").val(data.rtn004);
                $("#rtn005").val(data.rtn005);
                $("#rtn006").val(data.rtn006);
                $("#aac002").val(data.aac002);
                $("#aac003").val(data.aac003);
                $("#aac006").val(data.aac006);
                $("#companyid").val(data.companyid);
                $("#aab301_relation").val(data.aab301);
                $("#aac004").prop("value",data.aac004);
                $("#type").val(data.type);
            },
            complete:function(){
                $("#aac002").attr("readOnly",true);
            },
            error:function(){
                //请求出错处理
            }
        });
    }



    /**
     *删除劳动力信息
     */
    function delworker(id){
        swal({
            title: "您确定要删除这条信息吗",
            text: "删除后将无法恢复，请谨慎操作！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "删除",
            cancelButtonText:"取消",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url:"/Relation/people",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:{_method:"DELETE","rtn001":id},    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'yes'){
                            worker_datatable.ajax.reload();
                            swal("删除成功！", "您已经永久删除了这条信息。", "success");
                        }else if(data == 'no'){
                            swal("删除失败！", "您未删除这条信息。", "fail");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });

        });
    }

    //校验身份证
    function countPlf005(aac002){

        var pattern = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
        if(!pattern.test(aac002)){
            $("#aac002").val('');
            $("#aac002").focus;
            swal({
                title: "身份证错误!",
                text: "您好！请输入正确的身份证号码",
                timer: 2000,
                showConfirmButton: false
            });
        }else{
            queryWorkerByIdCard_old(aac002);
        }

    }


    /**
     * 根据身份证号码查询该劳动力是否已经登记   ()
     * 劳动力   2019-11-20日因为增加 上岗年月判断，所以这个临时不用了
     */
    function queryWorkerByIdCard_old(aac002) {
        var flag = 1;
        var rtn003 = $("#rtn003").val();//上岗年月
        $.ajax({
            url:"/Relation/Register",    //请求的url地址
            dataType:"text",   //返回格式为json
            async:false,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"aac002":aac002},    //参数值
            type:"GET",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                //请求成功时处理
                if(data != null && data != undefined){
                    if(data == 'no'){

                        $("#aac002").val('');
                        $("#aac002").focus();
                        swal({
                            title: "该劳动力未登记!",
                            text: "您好！该劳动力信息未登记，请在贫困劳动力页面进行登记登记",
                            timer: 2000,
                            showConfirmButton: false
                        });


                    }else if(data == 'have'){
                        $("#aac002").val('');
                        $("#aac002").focus();
                        swal({
                            title: "该劳动力已经登记在社区工厂或扶贫基地了!",
                            text: "您好！该劳动力已经登记在社区工厂或扶贫基地了，不能重复登记",
                            timer: 2000,
                            showConfirmButton: false
                        });
                    }else{
                        $("#aac003").val(data);
                        //获取出生日期
                        //var birthday = phd003.substring(6, 10) + "-" + phd003.substring(10, 12) + "-" + phd003.substring(12, 14);
                        //获取性别
                        if (parseInt(aac002.substr(16, 1)) % 2 == 1) {
                            $("#aac004").prop("value",1);
                        } else {
                            $("#aac004").prop("value",2);//女
                        }
                        //获取年龄
                        var myDate = new Date();
                        var month = myDate.getMonth() + 1;
                        var day = myDate.getDate();

                        var age = myDate.getFullYear() - aac002.substring(6, 10) - 1;
                        if (aac002.substring(10, 12) < month || aac002.substring(10, 12) == month && aac002.substring(12, 14) <= day) {
                            age++;
                        }
                        $("#aac006").val(age);
                        //说明该贫困户已经登记，不能重复登记

                        flag = 0;
                    }

                }
                return flag;
            },
            complete:function(){
                //请求完成的处理
            },
            error:function(){
                //请求出错处理
            }
        });
    }




    /**
     * 根据身份证号码查询该劳动力是否已经登记
     * 劳动力
     */
    function queryWorkerByIdCard() {
        var flag = 1;
        var aac002 = $("#aac002").val();//身份证
        var rtn003 = $("#rtn003").val();//上岗年月
        $.ajax({
            url:"/Relation/queryWorkerByIdCard",    //请求的url地址
            dataType:"text",   //返回格式为json
            async:false,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"aac002":aac002,"rtn003":rtn003},    //参数值
            type:"GET",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                //请求成功时处理
                if(data != null && data != undefined){
                    if(data == 'no'){

                        $("#aac002").val('');
                        $("#aac002").focus();
                        swal({
                            title: "该劳动力未登记!",
                            text: "您好！该劳动力信息未登记，请在贫困劳动力页面进行登记登记",
                            timer: 2000,
                            showConfirmButton: false
                        });


                    }else if(data == 'have'){
                        $("#aac002").val('');
                        $("#aac002").focus();
                        swal({
                            title: "该劳动力已经登记在社区工厂或扶贫基地了!",
                            text: "您好！该劳动力已经登记在社区工厂或扶贫基地了，不能重复登记",
                            timer: 2000,
                            showConfirmButton: false
                        });
                    }else{
                        $("#aac003").val(data);
                        //获取出生日期
                        //var birthday = phd003.substring(6, 10) + "-" + phd003.substring(10, 12) + "-" + phd003.substring(12, 14);
                        //获取性别
                        if (parseInt(aac002.substr(16, 1)) % 2 == 1) {
                            $("#aac004").prop("value",1);
                        } else {
                            $("#aac004").prop("value",2);//女
                        }
                        //获取年龄
                        var myDate = new Date();
                        var month = myDate.getMonth() + 1;
                        var day = myDate.getDate();

                        var age = myDate.getFullYear() - aac002.substring(6, 10) - 1;
                        if (aac002.substring(10, 12) < month || aac002.substring(10, 12) == month && aac002.substring(12, 14) <= day) {
                            age++;
                        }
                        $("#aac006").val(age);
                        //说明该贫困户已经登记，不能重复登记

                        flag = 0;
                    }

                }
                return flag;
            },
            complete:function(){
                //请求完成的处理
            },
            error:function(){
                //请求出错处理
            }
        });
    }



    /**
     * 根据aab301查找名称
     */
    function queryAab301Info(aab301,hidden_id) {
        $.ajax({
            url:"/Information/queryAab301Info",    //请求的url地址
            dataType:"json",   //返回格式为json
            async:false,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"aab301":aab301},    //参数值
            type:"POST",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                //请求成功时处理
                if(data != null && data != undefined){
                    $("#"+hidden_id).val(data.info);
                }
            },
            complete:function(){

            },
            error:function(){
                //请求出错处理
            }
        });
    }
    
    //添加劳动力的方法
    function addWorker() {
        $('#myTab li:eq(0) a').tab('show');
        $("#aac002").attr("readOnly",false);
        var pab001 = $("#pab001").val();
        $("#companyid").val(pab001);
        var aab301 = $("#aab301").val();
        $("#aab301_relation").val(aab301);
        $("#aab301_a").val(aab301);
        $("#type").val("2");
    }

    //点击添加扶贫基地按钮
    function addPoverty() {
        queryCentralizedSettlements();
        var aab301 = $("#aab301").val();
        queryAab301Info(aab301,"aab301_id");
    }


    function checkAll_worker(){
        var pab001 = $("#pab001").val();
        var aac002 = $("#aac002").val();
        var aac003 = $("#aac003").val();
        var aac004 = $("#aac004").val();
        var aac006 = $("#aac006").val();
        var rtn002 = $("#rtn002").val();
        var rtn003 = $("#rtn003").val();
        var rtn004 = $("#rtn004").val();
        var rtn005 = $("#rtn005").val();
        var rtn006 = $("#rtn006").val();

        var flag = 0;
        if(pab001 =="" || pab001 == null){
            swal({
                title: "请保存扶贫基地!",
                text: "您好！请保存扶贫基地",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(aac002 =="" || aac002 == null){
            swal({
                title: "请输入身份证号码!",
                text: "您好！身份证号码不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(rtn002 =="" || rtn002 == null){
            swal({
                title: "请输入家庭住址!",
                text: "您好！家庭住址不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(rtn003 =="" || rtn003 == null){
            swal({
                title: "请输入上岗年月!",
                text: "您好！上岗年月不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(rtn004 =="" || rtn004 == null){
            swal({
                title: "请输入签订合同或协议(月)!",
                text: "您好！签订合同或协议（月）不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        /*if(rtn005 =="" || rtn005 == null){
            swal({
                title: "请输入离职年月!",
                text: "您好！离职年月不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }*/
        if(rtn006 =="" || rtn006 == null){
            swal({
                title: "请输入月工资!",
                text: "您好！月工资不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }


        flag = 1;
        return flag;
    }

//扶贫基地清空
    function cleaninput_worker(flag) {

        var rtn001 = $("#rtn001").val();
        var companyid = $("#companyid").val();
        var aab301 = $("#aab301_relation").val();
        var type = $("#type").val();
        $("#workeradd input").val('');
        $("#companyid").val(companyid);
        $("#aab301_relation").val(aab301);
        $("#type").val(type);
        $("#aac004").prop("value","");
        if(flag !='saveorupdate'){
            if(rtn001 != null && rtn001 !=''){
                updateWorker(rtn001);
            }else{
            }
        }

    }

    /**
     * 查询集中安置点名称，获取对应的下拉值
     */
    function queryCentralizedSettlements(){
        var aab301 = $("#aab301").val();
        $("#pab013").empty();

        $.ajax({
            url:"/aa10/queryCentralizedSettlementsByAab301",    //请求的url地址
            dataType:"json",   //返回格式为json
            async:false,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"aab301":aab301},    //参数值
            type:"POST",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                //请求成功时处理
                if(data != null && data != undefined){
                    var options ="";
                    options +="<option value=''>-- 请选择 --</option>";
                    for(var i=0;i<data.length;i++){
                        options +="<option value='"+data[i].cts001+"'>"+data[i].cts002+"</option>";
                    }


                    $("#pab013").append(options);
                }
            },
            complete:function(){
                //请求完成的处理
            },
            error:function(){
                //请求出错处理
            }
        });
    }

    //选择 是否扶贫安置点下拉框
    function changeCtf015(value){
        if(value=='1'){     //说明选中的是  “是”
            $("#show_ctf004").show();
        }else{
            $("#show_ctf004").hide();
        }
    }


    /**
     * 查询参数，获取对应的下拉值
     */
    function queryAllAa10list() {
        var aaa100 = ["AAC004","EDC441","AAA009","NIANDU"];
        $.ajax({
            url: "/aa10/queryAllAa10list",    //请求的url地址
            dataType: "json",   //返回格式为json
            async: false,//请求是否异步，默认为异步，这也是ajax重要特性
            // data: {"aaa100list": JSON.stringify(aaa100).toString()},    //参数值
            data:{},
            type: "POST",   //请求方式
            beforeSend: function () {
                //请求前的处理
            },
            success: function (data) {
                //请求成功时处理
                if (data != null && data != undefined) {

                    for(var i=0;i<data.length;i++){
                        var options = "";
                        if(data[i].aaa100 == 'AAC004'){
                            options += "<option value='" + data[i].aaa102 + "'>" + data[i].aaa103 + "</option>";
                            $("#aac004").append(options);
                        }
                        if(data[i].aaa100 == 'EDC441'){
                            options += "<option value='" + data[i].aaa102 + "'>" + data[i].aaa103 + "</option>";
                            $("#pab014").append(options);
                            $("#pab014_scan").append(options);
                            $("#pab016").append(options);
                            $("#pab016_scan").append(options);
                        }
                        if(data[i].aaa100 == 'AAA009'){
                            options += "<option value='" + data[i].aaa102 + "'>" + data[i].aaa103 + "</option>";
                            $("#pab010").append(options);
                            $("#pab010_scan").append(options);
                        }else if(data[i].aaa100 == 'NIANDU'){
                            options += "<option value='" + data[i].aaa102 + "'>" + data[i].aaa103 + "</option>";
                            $("#eps004").append(options);
                        }
                    }
                }
            },
            complete: function () {
                //请求完成的处理
            },
            error: function () {
                //请求出错处理
            }
        });
    }


    /****************************以下是补贴信息******************************************************************************************************************************************************/
    //点击补贴添加按钮
    function addSubsiby(){
        $('#myTab li:eq(1) a').tab('show');
        //给补贴的扶贫基地隐藏字段是指基地id
        var pab001 = $("#pab001").val();
        $("#eps002").val(pab001);
    }

    function loadSubsiby(){
        var aab301 = $("#aab301").val();
        //重要修改 表格内容的自定义，需要根据业务定制
        subsiby_datatable = $("#subsiby_table").dataTable({
            destroy: true,
            autoWidth: false,  //禁用自动调整列宽
            ordering: false,//禁止排序
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: false,  //隐藏加载提示,自行处理
            serverSide: false,  //启用服务器端分页
            aLengthMenu: [10, 20, 50, 100],  //用户可自选每页展示数量 5条或10条
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            paging: false,//禁止分页
            info: false,
            columnDefs: [{
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {
                $("#loading_div").modal('show');
                //封装请求参数

                var pab001 = $("#pab001").val();//贫困户model中的id
                var param = {"eps002":pab001};

                //ajax请求数据方法
                $.ajax({
                    type: "POST",
                    url: "/povertyBase/querEmploymentPovertySubsidyByEps002",//url请求的地址
                    cache: false,  //禁用缓存
                    data: param,  //传入组装的参数
                    dataType: "json",
                    success: function (result) {
                        //封装返回数据重要
                        //封装返回数据重要
                        var returnData = {};
                        //返回的数据列表
                        returnData.data = result;
                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                        $("#loading_div").modal('hide');
                    }
                });
            },
            //列表表头字段
            columns: [
                { "data": "eps004" },
                { "data": "eps005" },
                { "data": "eps006" },
                { "data": "eps007" },
                { "data": "eps008" },
                {"data":"eps001","width":"120px", "render":function(data, type, full, meta){
                    if(treetype <= 3){     //说明是区县以上用户登录的，则可以删除
                        return	data="<button onclick=\"updateSubsiby('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#subsibyadd' >修 改</button>   <button  class='btn btn-sm btn-danger btn-del' onclick=\"delSubsiby('"+data+"')\">删 除</button>  ";
                    }else {   //说明是区县一下人登录的，则只能修改
                        return	data="<button onclick=\"updateSubsiby('"+data+"')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#subsibyadd' >修 改</button>  ";
                    }
                }}]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }
    /**
     * 保存享受政策
     */
    function saveSubsiby(){
        var aab301 = $("#aab301").val();
        if(checkAll_subsiby() == 1){
            $.ajax({
                url: "/povertyBase/saveEmploymentPovertySubsidy?aab301=" + $("#aab301").val(),    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:$('#subsibyForm').serialize(),    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){

                    //请求成功时处理
                    if(data != null && data != undefined){
                        cleaninput_subsiby('save');
                        if(data == 'update'){
                            //请求完成的处理
                            loadSubsiby();
                            $("#subsibyadd").modal("hide");
                            swal("修改成功！", "您已经成功修改了这条信息。", "success");
                        }else{  //说明是新增
                            //请求完成的处理
                            loadSubsiby();
                            $("#subsibyadd").modal("hide");
                            swal("保存成功！", "您已经成功保存了这条信息。", "success");
                        }
                    }
                },
                complete:function(){
                },
                error:function(){
                    //请求出错处理
                }
            });
        }

    }


    function checkAll_subsiby(){
        var eps004 = $("#eps004").val();
        var eps005 = $("#eps005").val();
        var eps006 = $("#eps006").val();
        var eps007 = $("#eps007").val();
        var eps008 = $("#eps008").val();

        var flag = 0;
        if(eps005 =="" || eps005 == null){
            swal({
                title: "请输入以工代训补贴!",
                text: "您好！以工代训补贴不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }
        if(eps007 =="" || eps007 == null){
            swal({
                title: "请输入奖补性职业介绍补贴!",
                text: "您好！奖补性职业介绍补贴不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }

        if(eps008 =="" || eps008 == null){
            swal({
                title: "请输入享受人数!",
                text: "您好！享受人数不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }

        if(eps004 =="" || eps004 == null){
            swal({
                title: "请输入补贴年度!",
                text: "您好！补贴年度不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }

        if(eps006 =="" || eps006 == null){
            swal({
                title: "一次性奖补资金!",
                text: "您好！一次性奖补资金不能为空",
                timer: 2000,
                showConfirmButton: false
            });
            return flag;
        }


        flag = 1;
        return flag;
    }

    /**
     * 修改补贴信息
     */
    function updateSubsiby(id){
        $("#subsibyadd_head").text("修改享受政策信息");
        $.ajax({
            url:"/povertyBase/updateEmploymentPovertySubsidy",    //请求的url地址
            dataType:"json",   //返回格式为json
            async:false,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"eps001":id},    //参数值
            type:"POST",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data){
                $("#eps001").val(data.eps001);
                $("#eps002").val(data.eps002);
                $("#eps004").prop("value",data.eps004);
                $("#eps005").val(data.eps005);
                $("#eps006").val(data.eps006);
                $("#eps007").val(data.eps007);
                $("#eps008").val(data.eps008);
            },
            complete:function(){

            },
            error:function(){
                //请求出错处理
            }
        });
    }



    /**
     *删除补贴信息
     */
    function delSubsiby(id){
        swal({
            title: "您确定要删除这条信息吗",
            text: "删除后将无法恢复，请谨慎操作！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "删除",
            cancelButtonText:"取消",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url:"/povertyBase/deleteEmploymentPovertySubsidy",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:{"eps001":id},    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'yes'){
                            loadSubsiby();
                            swal("删除成功！", "您已经永久删除了这条信息。", "success");
                        }else if(data == 'no'){
                            swal("删除失败！", "您未删除这条信息。", "fail");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });

        });
    }

    //补贴清空按钮
    function cleaninput_subsiby(flag) {
        var eps001 = $("#eps001").val();
        $("#subsibyadd input").val('');
        $("#eps004").prop("value","");
        if(flag !='saveorupdate'){
            if(eps001 != null && eps001 !=''){
                updateSubsiby(eps001);
            }else{
            }
        }
    }

</script>

<script>
    window.onload = function(){
        //屏蔽键盘事件
        document.onkeydown = function (){
            var e = window.event || arguments[0];
            //F12
            if(e.keyCode == 123){
                return false;
                //Ctrl+Shift+I
            }else if((e.ctrlKey) && (e.shiftKey) && (e.keyCode == 73)){
                return false;
                //Shift+F10
            }else if((e.shiftKey) && (e.keyCode == 121)){
                return false;
                //Ctrl+U
            }else if((e.ctrlKey) && (e.keyCode == 85)){
                return false;
            }
        };
        //屏蔽鼠标右键
        document.oncontextmenu = function (){
            return false;
        }
    }
</script>

</body>

</html>
