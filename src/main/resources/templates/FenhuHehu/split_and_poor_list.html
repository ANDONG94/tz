<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>分户合户</title>
    <link href="/css/hjia/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="/css/hjia/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="/css/hjia/animate.min.css" rel="stylesheet">
    <link href="/css/hjia/style.min.css?v=4.1.0" rel="stylesheet">
    <link href="/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <link href="/js/ztree/css/zTreeStyle.css" rel="stylesheet">
    <link href="/css/plugins/dataTables/dataTables.bootstrap.css" type="text/css" rel="stylesheet">

    <script src="/js/hjia/jquery.min.js?v=2.1.4"></script>
    <script src="/js/hjia/bootstrap.min.js?v=3.3.6"></script>
    <script src="/js/hjia/content.min.js?v=1.0.0"></script>

    <script src="/js/ztree/jquery.ztree.core.js"></script>
    <script src="/js/ztree/jquery.ztree.excheck.js"></script>
    <script src="/js/ztree/jquery.ztree.exedit.js"></script>

    <script src="/js/hjia/plugins/jeditable/jquery.jeditable.js"></script>
    <script src="/js/hjia/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="/js/hjia/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="/js/hjia/content.min.js?v=1.0.0"></script>
    <script src="/js/hjia/plugins/layer/layer.min.js"></script>
    <script src="/js/hjia/demo/layer-demo.min.js"></script>
    <script src="/js/hjia/plugins/validate/jquery.validate.min.js"></script>
    <script src="/js/hjia/plugins/validate/messages_zh.min.js"></script>
    <script src="/js/hjia/demo/form-validate-demo.min.js"></script>
    <script src="/js/hjia/plugins/sweetalert/sweetalert.min.js"></script>
    <script src="/js/hjia/plugins/layer/laydate/laydate.js"></script>


    <style>
        .col-lable2{width: 12%}
        .col-lable3{width: 21%}
        .col-lable4{width: 23%}
        .col-lable5{width: 73%}
        .form-group{
            margin-bottom: 0px;
        }
    </style>

</head>

<body class="gray-bg">
<div class="">
    <div class="row">
        <div class="col-sm-3" style="padding-right: 2px;width:17%">
            <div class="ibox-content" id="ztree_div_div" style="overflow-y:auto;">
                <ul id="tree-div" class="ztree" style="overflow: auto;"></ul>
            </div>
        </div>
        <div class="col-sm-9 animated fadeInRight" style="padding-left: 15px;width:83%">
            <!--这是列表信息开始-->
            <div class="row">
                <div class="col-sm-13" style="margin-top: 0%;">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <div class="form-group">
                                <label class="col-sm-1 control-label" style="width: 12%">劳动力身份证：</label>
                                <div class="col-sm-2" style="top: -7px; margin-left: -25px">
                                    <input id="sap007" name="sap007" placeholder="请输入劳动力身份证..." type="text" class="form-control" required="" aria-required="true">
                                </div>
                                <label class="col-sm-1 control-label" style="width: 12%">原户主身份证：</label>
                                <div class="col-sm-2" style="top: -7px; margin-left: -25px">
                                    <input id="sap004" name="sap004" placeholder="请输入原户主身份证..." type="text" class="form-control" required="" aria-required="true">
                                </div>
                                <label class="col-sm-1 control-label" style="width: 12%">新户主身份证：</label>
                                <div class="col-sm-2" style="top: -7px; margin-left: -25px">
                                    <input id="sap005" name="sap005" placeholder="请输入新户主身份证..." type="text" class="form-control" required="" aria-required="true">
                                </div>
                            </div>
                            <span id="split_btn" ><a  href="javascript:void(0);"  class="btn btn-primary " data-toggle="modal"  data-target="#split_and_poor_fen" style="float: right;margin-top: -1%; margin-right: 1%">分户</a></span>
                            <span id="add_btn" ><a  href="javascript:void(0);"  class="btn btn-primary " data-toggle="modal" onclick="addinfo()" data-target="#split_and_poor_add" style="float: right;margin-top: -1%; margin-right: 1%">合户</a></span>
                            <a  href="javascript:void(0);" class="btn btn-primary " onclick="searchInformation()" style="float: right;margin-top: -1%; margin-right: 1%">查询</a>
                        </div>
                        <div class="ibox-content" id="table_div">
                            <table class="table table-striped table-bordered table-hover " id="split_and_poor_table"><thead>
                            <tr>
                                <th>序号</th>
                                <th>所属行政区</th>
                                <th>劳动力名称</th>
                                <th>劳动力身份证号</th>
                                <th>原户主名称</th>
                                <th>新户主名称</th>
                                <th>原户主身份证号</th>
                                <th>新户主身份证号</th>
                                <th>迁移时间</th>
                            </tr>
                            </thead></table><table>
                        </table>

                        </div>
                    </div>
                </div>
            </div>
            <!--这是列表信息结束-->
        </div>
    </div>
</div>

<!--模态窗口  合户  div-->
<div class="modal inmodal" id="split_and_poor_add" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="margin:auto;width:90%">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header" style="padding: 10px 15px;text-align: left">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
                </button>
                <h6 id="split_and_poor_head" class="modal-title" style="font-size:16px">合户</h6>
            </div>
            <div class="modal-body" style="height: 500px;">
                <div class="col-sm-6" id="old_poor_table_div">
                    <label class="col-sm-3 control-label" style="width: 25%">原户主身份证：</label>
                    <div class="col-sm-6" style="top: -7px; margin-left: -25px">
                        <input id="phd003_old" name="phd003_old" placeholder="请输入原户主身份证..." type="text" class="form-control" >
                    </div>
                    <table class="table table-striped table-bordered table-hover " id="old_poor_table"><thead>
                    <tr>
                        <th>所属行政区</th>
                        <th>姓名</th>
                        <th>身份证号</th>
                        <th>操作</th>
                    </tr>
                    </thead></table><table>
                     </table>
                </div>
                <div class="col-sm-6" id="new_poor_table_div">
                    <label class="col-sm-3 control-label" style="width: 25%">新户主身份证：</label>
                    <div class="col-sm-6" style="top: -7px; margin-left: -25px">
                        <input id="phd003_new" name="phd003_new" placeholder="请输入新户主身份证..." type="text" class="form-control" >
                    </div>
                    <a  href="javascript:void(0);" class="btn btn-primary " onclick="searcholdNew()" style="float: right;margin-top: -1%; margin-right: 1%">查询</a>
                    <a  href="javascript:void(0);" class="btn btn-primary " onclick="cleaninput()" style="float: right;margin-top: -1%; margin-right: 1%">清空</a>
                    <table class="table table-striped table-bordered table-hover " id="new_poor_table"><thead>
                    <tr>
                        <th>所属行政区</th>
                        <th>姓名</th>
                        <th>身份证号</th>
                        <th>操作</th>
                    </tr>
                    </thead></table><table>
                </table>
                </div>

            </div>
            <!--<div class="modal-footer" id="btn_div" style="text-align: center">
                <button type="button" class="btn btn-primary" id="save_anzhidian_btn" onclick="savesplitAndPoor()">保存</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="button" class="btn btn-white" onclick="cleaninput('qingkong')">清空</button>
            </div>-->
        </div>
    </div>
</div>
<!--模态窗口  合户信息  div-->

<!--模态窗口  分户  div-->
<div class="modal inmodal" id="split_and_poor_fen" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="margin:auto;width:90%">
        <div class="modal-content animated bounceInRight">
            <div class="modal-header" style="padding: 10px 15px;text-align: left">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">关闭</span>
                </button>
                <h6 id="split_and_poor_head_fen" class="modal-title" style="font-size:16px">分户</h6>
            </div>
            <div class="modal-body" style="height: 500px;">
                <div class="col-sm-6" id="old_poor_table_div_fen">
                    <label class="col-sm-3 control-label" style="width: 25%">原户主身份证：</label>
                    <div class="col-sm-6" style="top: -7px; margin-left: -25px">
                        <input id="phd003_old_fen" name="phd003_old_fen" placeholder="请输入原户主身份证..." type="text" class="form-control" >
                    </div>
                    <table class="table table-striped table-bordered table-hover " id="old_poor_table_fen"><thead>
                    <tr>
                        <th>所属行政区</th>
                        <th>姓名</th>
                        <th>身份证号</th>
                        <th>操作</th>
                    </tr>
                    </thead></table><table>
                </table>
                </div>
                <div class="col-sm-6" id="new_poor_table_div_fen">
                    <label class="col-sm-3 control-label" style="width: 25%">新户主身份证：</label>
                    <div class="col-sm-6" style="top: -7px; margin-left: -25px">
                        <input id="phd003_new_fen" readonly="readonly" name="phd003_new_fen" placeholder="请输入新户主身份证..." type="text" class="form-control" >
                    </div>
                    <a  href="javascript:void(0);" class="btn btn-primary " onclick="searcholdNew_fen()" style="float: right;margin-top: -1%; margin-right: 1%">查询</a>
                    <a  href="javascript:void(0);" class="btn btn-primary " onclick="cleaninput_fen()" style="float: right;margin-top: -1%; margin-right: 1%">清空</a>
                    <table class="table table-striped table-bordered table-hover " id="new_poor_table_fen"><thead>
                    <tr>
                        <th>所属行政区</th>
                        <th>姓名</th>
                        <th>身份证号</th>
                        <th>操作</th>
                    </tr>
                    </thead></table><table>
                </table>
                </div>

            </div>
            <!--<div class="modal-footer" id="btn_div" style="text-align: center">
                <button type="button" class="btn btn-primary" id="save_anzhidian_btn" onclick="savesplitAndPoor()">保存</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="button" class="btn btn-white" onclick="cleaninput('qingkong')">清空</button>
            </div>-->
        </div>
    </div>
</div>
<!--模态窗口  分户  div-->

<input id="aab301" name="aab301"  type="hidden" >
<!--等待的模态框  和等待特效-->
<div class="modal inmodal fade" id="loading_div" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-sm">
        <div class="scene">
            <svg style="width: 200px;height: 200px;"
                 version="1.1"
                 id="dc-spinner"
                 xmlns="http://www.w3.org/2000/svg"
                 x="0px" y="0px"
                 viewBox="0 0 38 38"
                 preserveAspectRatio="xMinYMin meet"
            >
                <text x="14" y="21" font-family="Monaco" font-size="2px" style="letter-spacing:0.6" fill="yellow">LOADING
                    <animate
                            attributeName="opacity"
                            values="0;1;0" dur="1.8s"
                            repeatCount="indefinite"/>
                </text>
                <path fill="#373a42" d="M20,35c-8.271,0-15-6.729-15-15S11.729,5,20,5s15,6.729,15,15S28.271,35,20,35z M20,5.203
    C11.841,5.203,5.203,11.841,5.203,20c0,8.159,6.638,14.797,14.797,14.797S34.797,28.159,34.797,20
    C34.797,11.841,28.159,5.203,20,5.203z">
                </path>

                <path fill="#373a42" d="M20,33.125c-7.237,0-13.125-5.888-13.125-13.125S12.763,6.875,20,6.875S33.125,12.763,33.125,20
    S27.237,33.125,20,33.125z M20,7.078C12.875,7.078,7.078,12.875,7.078,20c0,7.125,5.797,12.922,12.922,12.922
    S32.922,27.125,32.922,20C32.922,12.875,27.125,7.078,20,7.078z">
                </path>

                <path fill="#2AA198" stroke="#2AA198" stroke-width="0.6027" stroke-miterlimit="10" d="M5.203,20
			c0-8.159,6.638-14.797,14.797-14.797V5C11.729,5,5,11.729,5,20s6.729,15,15,15v-0.203C11.841,34.797,5.203,28.159,5.203,20z">
                    <animateTransform
                            attributeName="transform"
                            type="rotate"
                            from="0 20 20"
                            to="360 20 20"
                            calcMode="spline"
                            keySplines="0.4, 0, 0.2, 1"
                            keyTimes="0;1"
                            dur="2s"
                            repeatCount="indefinite" />
                </path>

                <path fill="#859900" stroke="#859900" stroke-width="0.2027" stroke-miterlimit="10" d="M7.078,20
  c0-7.125,5.797-12.922,12.922-12.922V6.875C12.763,6.875,6.875,12.763,6.875,20S12.763,33.125,20,33.125v-0.203
  C12.875,32.922,7.078,27.125,7.078,20z">
                    <animateTransform
                            attributeName="transform"
                            type="rotate"
                            from="0 20 20"
                            to="360 20 20"
                            dur="1.8s"
                            repeatCount="indefinite" />
                </path>
            </svg>
        </div>
    </div>
</div>

<script>

    var split_and_poor_datatable;
    var new_poor_datatable;
    var old_poor_datatable;
    var new_poor_datatable_fen;
    var old_poor_datatable_fen;
    var lang;
    $(function () {
        //设置树的高度
        $("#ztree_div_div").css({"height":$(window).height()});
        $("#table_div").css({"height":$(window).height()-70});


        //点击叉号调用的事件
        $('#split_and_poor_add').on('hide.bs.modal', function () {
            $("#phd003_new").val('');
            $("#phd003_old").val('');
            loadWorkerByPhd0003_new();
            loadWorkerByPhd0003_old();

        });


        //树节点的初始化事件
        $.fn.zTree.init($("#tree-div"), sys_perm_setting);

        //提示信息  初始化设置 一般不需要改
        lang = {
            "sProcessing": "处理中...",
            "sLengthMenu": "每页 _MENU_ 项",
            "sZeroRecords": "没有匹配结果",
            "sInfo": "当前显示第 _START_ 至 _END_ 项，共 _TOTAL_ 项。",
            "sInfoEmpty": "当前显示第 0 至 0 项，共 0 项",
            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            "sInfoPostFix": "",
            "sSearch": "搜索:",
            "sUrl": "",
            "sEmptyTable": "表中数据为空",
            "sLoadingRecords": "载入中...",
            "sInfoThousands": ",",
            "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "上页",
                "sNext": "下页",
                "sLast": "末页",
                "sJump": "跳转"
            },
            "oAria": {
                "sSortAscending": ": 以升序排列此列",
                "sSortDescending": ": 以降序排列此列"
            }
        };

    })

    //树配置
    var sys_perm_setting = {
        edit: {
            drag:{
                prev: true,
                next: true,
                inner:true
            },
            enable: true,
            showRemoveBtn: false,
            showRenameBtn: false
        },
        view: {
            showLine: true,
            nameIsHTML: true
        },
        check: {
            enable: false,
            chkboxType:  { "Y": "s", "N": "s" } //chkboxType: { “Y”: “ps”, “N”: “ps” } Y 属性定义 checkbox 被勾选后的情况;N 属性定义 checkbox 取消勾选后的情况;“p” 表示操作会影响父级节点;“s” 表示操作会影响子级节点;请注意大小写，不要改变
        },
        data: {
            simpleData: {
                enable: true,
                pIdKey: "parentid"
            }
        },
        callback: {
            onClick: onClick,
            onAsyncSuccess:getTreeFirstNodeId
        },
        async: {
            enable: true,
            url:"/ztree/treedata",
            autoParam:["groupid"]
        }
    };


    //树节点的点击事件
    function onClick (event, treeId, treeNode, clickFlag) {
        $("#aab301").val(treeNode.groupid);
        loadsplitAndPoor();
        /*  if(treeNode.groupid.substring(4,6) !='00' && treeNode.groupid.substring(6,12) =='000000'){
         //说明是区县aab301,则显示添加按钮，和修改按钮列
         split_and_poor_datatable.column(2).visible(true)//将第一列的数据显示
         split_and_poor_datatable.column(3).visible(false)//将第一列的数据隐藏
         $("#add_btn").show();
         }else{
         split_and_poor_datatable.column(2).visible(false)//将第一列的数据隐藏
         split_and_poor_datatable.column(3).visible(true)//将第一列的数据显示
         $("#add_btn").hide();

         }*/

    }

    var treetype;         // 获取登录用户级别   树默认展开第一级节点
    function getTreeFirstNodeId(){
        var treeObj = $.fn.zTree.getZTreeObj("tree-div");
        var nodes = treeObj.getNodes();
        var firstNode = nodes[0];
        treeObj.expandNode(nodes[0], true);  treetype = firstNode.type;
        $("#aab301").val(firstNode.groupid);
        /* if(firstNode.groupid.substring(4,6) !='00' && firstNode.groupid.substring(6,12) =='000000'){
         //说明是区县aab301,则显示添加按钮，和修改按钮列
         split_and_poor_datatable.column(2).visible(true)//将第一列的数据显示
         split_and_poor_datatable.column(3).visible(false)//将第一列的数据隐藏
         $("#add_btn").show();
         }else{
         split_and_poor_datatable.column(2).visible(false)//将第一列的数据隐藏
         split_and_poor_datatable.column(3).visible(true)//将第一列的数据显示
         $("#add_btn").hide();
         }*/
    }

    //加载分户合户记录
    function  loadsplitAndPoor(){

        //重要修改 表格内容的自定义，需要根据业务定制
        split_and_poor_datatable = $("#split_and_poor_table").dataTable({
            language:lang,  //提示信息
            autoWidth: false,  //禁用自动调整列宽
            destroy: true,
            ordering:false,//禁止排序
            scrollY:$(window).height()-170,//表窗口高度-100px
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: false,  //隐藏加载提示,自行处理
            serverSide: true,  //启用服务器端分页
            bLengthChange:false,//去掉下面的没有多少条
            aLengthMenu:[50,100],  //用户可自选每页展示数量 5条或10条
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            columnDefs: [{
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {
                $("#loading_div").modal('show');
                //封装请求参数
                var param = {};
                param.length= data.length;//页面显示记录条数，在页面显示每页显示多少项的时候
                param.start = data.start;//开始的记录序号
                param.pageIndex = (data.start / data.length);//当前页码

                param.sap007 = $("#sap007").val();
                param.sap004 = $("#sap004").val();
                param.sap005 = $("#sap005").val();
                param.aab301 = $("#aab301").val();
                //ajax请求数据方法
                $.ajax({
                    type: "POST",
                    url: "/splitAndPoor/querySplitAndPoorByAab301",//url请求的地址
                    cache: false,  //禁用缓存
                    data: param,  //传入组装的参数
                    dataType: "json",
                    success: function (result) {
                        //封装返回数据重要
                        var returnData = {};
                        //这里直接自行返回了draw计数器,应该由后台返回
                        //returnData.draw = data.draw;
                        //返回数据全部记录
                        returnData.recordsTotal = result.recordsTotal;
                        //后台不实现过滤功能，每次查询均视作全部结果
                        returnData.recordsFiltered = result.recordsFiltered;
                        //返回的数据列表
                        returnData.data = result.data;

                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                        $("#loading_div").modal('hide');
                    }
                });
            },
            //列表表头字段
            columns: [
                { "data": "rn" },
                { "data": "aab301" },
                { "data": "sap006" },
                { "data": "sap007" },
                { "data": "sap002" },
                { "data": "sap003" },
                { "data": "sap004" },
                { "data": "sap005" },
                { "data": "aae037" }
            ]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }


    /**
     *输入条件进行查询
     */
    function searchInformation() {
        loadsplitAndPoor();
    }

    //点击添加 按钮
    function addinfo() {
        var aab301 = $("#aab301").val();
    }


    //点击查询模态框中的按钮  查询新旧身份证号下的成员信息
    function searcholdNew(){
        var phd003_old = $("#phd003_old").val();//劳动力id
        var phd003_new = $("#phd003_new").val();//劳动力id
        if(phd003_old == phd003_new){
            swal({
                title: "新旧户主身份证不能相同!",
                text: "您好！新旧户主身份证不能相同",
                timer: 2000,
                showConfirmButton: false
            });
            return;
        }
        if(phd003_old != null && phd003_new != null){
            var pattern = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
            if (!pattern.test(phd003_old)) {
                swal({
                    title: "原始身份证错误!",
                    text: "您好！请输入正确的身份证号码",
                    timer: 2000,
                    showConfirmButton: false
                });
                $("#phd003_old").val('');
                $("#phd003_old").focus();
                return;
            }
            if (!pattern.test(phd003_new)) {
                swal({
                    title: "新户主身份证错误!",
                    text: "您好！请输入正确的新户主身份证号码",
                    timer: 2000,
                    showConfirmButton: false
                });
                $("#phd003_new").val('');
                $("#phd003_new").focus();
                return;
            }
            loadWorkerByPhd0003_old();
            loadWorkerByPhd0003_new();
        }else{
            swal({
                title: "请输入户主身份证!",
                text: "您好！户主身份证不能为空",
                timer: 2000,
                showConfirmButton: false
            });
        }
    }


    //根据原户主身份证查询  该户下面的劳动力
    function loadWorkerByPhd0003_old() {
        //重要修改 表格内容的自定义，需要根据业务定制
        old_poor_datatable = $("#old_poor_table").dataTable({
            destroy: true,
            autoWidth: false,  //禁用自动调整列宽
            ordering: false,//禁止排序
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: false,  //隐藏加载提示,自行处理
            serverSide: false,  //启用服务器端分页
            aLengthMenu: [50, 100],  //用户可自选每页展示数量 5条或10条
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            paging: false,//禁止分页
            info: false,
            columnDefs: [{
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {

                //封装请求参数
                var phd003 = $("#phd003_old").val();//劳动力id
                var param = {"phd003": phd003};
                //根据劳动力id 查询就业信息
                //ajax请求数据方法
                $.ajax({
                    type: "POST",
                    url: "/splitAndPoor/queryWorkerByPhd003",//url请求的地址
                    cache: false,  //禁用缓存
                    data: param,  //传入组装的参数
                    dataType: "json",
                    success: function (result) {
                        //封装返回数据重要
                        var returnData = {};
                        //返回的数据列表
                        returnData.data = result;
                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                    }
                });
            },
            //列表表头字段
            columns: [
                {"data": "aab301"},
                {"data": "plf004"},
                {"data": "plf005"},
                {
                    "data": "plf001", "render": function (data, type, full, meta) {
                    return data = "<button onclick=\"removeLeftToRight('" + data + "')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#chuangyeadd' >右 移</button>  ";
                }
                }]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }


    //根据原户主身份证查询  改户下面的劳动力
    function loadWorkerByPhd0003_new() {
        //重要修改 表格内容的自定义，需要根据业务定制
        new_poor_datatable = $("#new_poor_table").dataTable({
            destroy: true,
            autoWidth: false,  //禁用自动调整列宽
            ordering: false,//禁止排序
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: false,  //隐藏加载提示,自行处理
            serverSide: false,  //启用服务器端分页
            aLengthMenu: [ 50, 100],  //用户可自选每页展示数量 5条或10条
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            paging: false,//禁止分页
            info: false,
            columnDefs: [{
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {
                //封装请求参数
                var phd003 = $("#phd003_new").val();//劳动力id
                var param = {"phd003": phd003};
                //根据劳动力id 查询就业信息
                //ajax请求数据方法
                $.ajax({
                    type: "POST",
                    url: "/splitAndPoor/queryWorkerByPhd003",//url请求的地址
                    cache: false,  //禁用缓存
                    data: param,  //传入组装的参数
                    dataType: "json",
                    success: function (result) {
                        //封装返回数据重要
                        var returnData = {};
                        //返回的数据列表
                        returnData.data = result;
                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                    }
                });
            },
            //列表表头字段
            columns: [
                {"data": "aab301"},
                {"data": "plf004"},
                {"data": "plf005"},
                {
                    "data": "plf001", "render": function (data, type, full, meta) {
                    return data = "<button onclick=\"removeRightToLeft('" + data + "')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#chuangyeadd' >左 移</button> ";
                }
                }]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }


//将右边的移动到左边
    function removeRightToLeft(plf001){
        var phd003_old = $("#phd003_old").val();
        var phd003_new = $("#phd003_new").val();
        swal({
            title: "您确定要移动该劳动力到左边吗",
            text: "请谨慎操作！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText:"取消",
            confirmButtonText: "移动",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url:"/splitAndPoor/removeWorker",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:{"plf001":plf001,"phd003_old":phd003_new,"phd003_new":phd003_old},    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'yes'){
                            loadWorkerByPhd0003_old();
                            loadWorkerByPhd0003_new();
                            loadsplitAndPoor();
                            swal("分户合户成功！", "您已经移动了这条信息。", "success");
                        }else if(data == 'no'){
                            swal("分户合户失败！", "您未移动这条信息。", "fail");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });

        });
    }


    //将左边的劳动力移动到右边
    function removeLeftToRight(plf001){
        var phd003_old = $("#phd003_old").val();
        var phd003_new = $("#phd003_new").val();
        swal({
            title: "您确定要移动该劳动力到右边吗",
            text: "请谨慎操作！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText:"取消",
            confirmButtonText: "移动",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url:"/splitAndPoor/removeWorker",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:{"plf001":plf001,"phd003_old":phd003_old,"phd003_new":phd003_new},    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'yes'){
                            loadsplitAndPoor();
                            loadWorkerByPhd0003_old();
                            loadWorkerByPhd0003_new();
                            swal("分户合户成功！", "您已经移动了这条信息。", "success");
                        }else if(data == 'no'){
                            swal("分户合户失败！", "您未移动这条信息。", "fail");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });

        });
    }


//合户点击清空按钮
    function cleaninput(){
        $("#phd003_new").val('');
        $("#phd003_old").val('');
        loadWorkerByPhd0003_new();
        loadWorkerByPhd0003_old();
    }




    //***************************以下是分户 **************************************************************************************************************

    //分户查询按钮
    function searcholdNew_fen(){
        loadWorkerByPhd0003_old_fen();//查询出老户主下的劳动力
    }


    //根据原户主身份证查询  该户下面的劳动力
    function loadWorkerByPhd0003_old_fen() {
        //重要修改 表格内容的自定义，需要根据业务定制
        old_poor_datatable_fen = $("#old_poor_table_fen").dataTable({
            destroy: true,
            autoWidth: false,  //禁用自动调整列宽
            ordering: false,//禁止排序
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: false,  //隐藏加载提示,自行处理
            serverSide: false,  //启用服务器端分页
            aLengthMenu: [50, 100],  //用户可自选每页展示数量 5条或10条
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            paging: false,//禁止分页
            info: false,
            columnDefs: [{
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {

                //封装请求参数
                var phd003 = $("#phd003_old_fen").val();//劳动力id
                var param = {"phd003": phd003};
                //根据劳动力id 查询就业信息
                //ajax请求数据方法
                $.ajax({
                    type: "POST",
                    url: "/splitAndPoor/queryWorkerByPhd003",//url请求的地址
                    cache: false,  //禁用缓存
                    data: param,  //传入组装的参数
                    dataType: "json",
                    success: function (result) {
                        //封装返回数据重要
                        var returnData = {};
                        //返回的数据列表
                        returnData.data = result;
                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                    }
                });
            },
            //列表表头字段
            columns: [
                {"data": "aab301"},
                {"data": "plf004"},
                {"data": "plf005"},
                {
                    "data": "plf001", "width": "150px", "render": function (data, type, full, meta) {
                    return data = "<button onclick=\"createNewPoor('" + data + "','" + full.plf005 + "')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal'  >设为新户主</button>  <button onclick=\"removeLeftToRight_fen('" + data + "')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#chuangyeadd' >右 移</button>  ";
                }
                }]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }


    //根据原户主身份证查询  改户下面的劳动力
    function loadWorkerByPhd0003_new_fen() {
        //重要修改 表格内容的自定义，需要根据业务定制
        new_poor_datatable_fen = $("#new_poor_table_fen").dataTable({
            destroy: true,
            autoWidth: false,  //禁用自动调整列宽
            ordering: false,//禁止排序
            stripeClasses: ["odd", "even"],  //为奇偶行加上样式，兼容不支持CSS伪类的场合
            processing: false,  //隐藏加载提示,自行处理
            serverSide: false,  //启用服务器端分页
            aLengthMenu: [ 50, 100],  //用户可自选每页展示数量 5条或10条
            searching: false,  //禁用原生搜索
            orderMulti: false,  //启用多列排序
            order: [],  //取消默认排序查询,否则复选框一列会出现小箭头
            renderer: "bootstrap",  //渲染样式：Bootstrap和jquery-ui
            pagingType: "full_numbers",  //分页样式：simple,simple_numbers,full,full_numbers
            paging: false,//禁止分页
            info: false,
            columnDefs: [{
                "targets": 'nosort',  //列的样式名
                "orderable": false    //包含上样式名‘nosort’的禁止排序
            }],
            ajax: function (data, callback, settings) {
                //封装请求参数
                var phd003 = $("#phd003_new_fen").val();//劳动力id
                var param = {"phd003": phd003};
                //根据劳动力id 查询就业信息
                //ajax请求数据方法
                $.ajax({
                    type: "POST",
                    url: "/splitAndPoor/queryWorkerByPhd003",//url请求的地址
                    cache: false,  //禁用缓存
                    data: param,  //传入组装的参数
                    dataType: "json",
                    success: function (result) {
                        //封装返回数据重要
                        var returnData = {};
                        //返回的数据列表
                        returnData.data = result;
                        //调用DataTables提供的callback方法，代表数据已封装完成并传回DataTables进行渲染
                        //此时的数据需确保正确无误，异常判断应在执行此回调前自行处理完毕
                        callback(returnData);
                    }
                });
            },
            //列表表头字段
            columns: [
                {"data": "aab301"},
                {"data": "plf004"},
                {"data": "plf005"},
                {
                    "data": "plf001", "render": function (data, type, full, meta) {
                    return data = "<button onclick=\"removeRightToLeft_fen('" + data + "')\"  class='btn btn-sm btn-primary btn-edit' data-toggle='modal' data-target='#chuangyeadd' >左 移</button> ";
                }
                }]
        }).api();
        //此处需调用api()方法,否则返回的是JQuery对象而不是DataTables的API对象
    }


    //设置为户主
    function createNewPoor(plf001,plf005){
        var phd003_old = $("#phd003_old_fen").val();//获取原户主身份证号码
        $("#phd003_new_fen").val(plf005);
        swal({
            title: "您确定要将该劳动力设为新户主吗",
            text: "请谨慎操作，操作后不能改变！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText:"取消",
            confirmButtonText: "确定",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url: "/splitAndPoor/createNewPoor",    //请求的url地址
                dataType: "text",   //返回格式为json
                async: false,//请求是否异步，默认为异步，这也是ajax重要特性
                data: {"plf001": plf001, "phd003_old": phd003_old},    //参数值
                type: "POST",   //请求方式
                beforeSend: function () {
                    //请求前的处理
                },
                success: function (data) {
                    //请求成功时处理
                    if (data != null && data != undefined) {
                        if (data == 'yes') {
                            loadsplitAndPoor();
                            loadWorkerByPhd0003_old_fen();
                            loadWorkerByPhd0003_new_fen();
                            swal("分户成功！", "您已经分户成功。", "success");
                        } else if (data == 'no') {
                            swal("分户失败！", "您未移动这条信息。", "fail");
                        }
                    }
                },
                complete: function () {

                },
                error: function () {
                    //请求出错处理
                }
            });
        });
    }


    //分户点击清空按钮
    function cleaninput_fen(){
        $("#phd003_new_fen").val('');
        $("#phd003_old_fen").val('');
        loadWorkerByPhd0003_old_fen();
        loadWorkerByPhd0003_new_fen();
    }


    //将右边的移动到左边
    function removeRightToLeft_fen(plf001){
        var phd003_old = $("#phd003_old_fen").val();
        var phd003_new = $("#phd003_new_fen").val();
        swal({
            title: "您确定要移动该劳动力到左边吗",
            text: "请谨慎操作！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText:"取消",
            confirmButtonText: "移动",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url:"/splitAndPoor/removeWorker",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:{"plf001":plf001,"phd003_old":phd003_new,"phd003_new":phd003_old},    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'yes'){
                            loadWorkerByPhd0003_old_fen();
                            loadWorkerByPhd0003_new_fen();
                            loadsplitAndPoor();
                            swal("分户合户成功！", "您已经移动了这条信息。", "success");
                        }else if(data == 'no'){
                            swal("分户合户失败！", "您未移动这条信息。", "fail");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });

        });
    }


    //将左边的劳动力移动到右边
    function removeLeftToRight_fen(plf001){
        var phd003_old = $("#phd003_old_fen").val();
        var phd003_new = $("#phd003_new_fen").val();
        swal({
            title: "您确定要移动该劳动力到右边吗",
            text: "请谨慎操作！",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            cancelButtonText:"取消",
            confirmButtonText: "移动",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                url:"/splitAndPoor/removeWorker",    //请求的url地址
                dataType:"text",   //返回格式为json
                async:false,//请求是否异步，默认为异步，这也是ajax重要特性
                data:{"plf001":plf001,"phd003_old":phd003_old,"phd003_new":phd003_new},    //参数值
                type:"POST",   //请求方式
                beforeSend:function(){
                    //请求前的处理
                },
                success:function(data){
                    //请求成功时处理
                    if(data != null && data != undefined){
                        if(data == 'yes'){
                            loadsplitAndPoor();
                            loadWorkerByPhd0003_old_fen();
                            loadWorkerByPhd0003_new_fen();
                            swal("分户合户成功！", "您已经移动了这条信息。", "success");
                        }else if(data == 'no'){
                            swal("分户合户失败！", "您未移动这条信息。", "fail");
                        }
                    }
                },
                complete:function(){

                },
                error:function(){
                    //请求出错处理
                }
            });

        });
    }

</script>
</body>

</html>
