#####白水县刷数据
~~~sql
begin for cc in (
  select a.phd001 phd001_y,b.phd001 phd001_x from (
select phd001,phd003 from poor_households where  aab301 like '610527006%' and aae100='0'
 ) a,(select phd001,phd003 from poor_households where  aab301 like '610527006%' and aae100='1'
)b
where  a.phd003=b.phd003
  )loop 
  
  update poor_labor_force set plf002=cc.phd001_x where plf002=cc.phd001_y;
  end loop ;
  
  end ;

~~~select xzqhmc aab301,
          
          转移就业总数 pht001,
          镇内 pht002,
          镇外县内 pht003,
          县外市内 pht004,
          市外省内 pht005,
          省外 pht006,
          国外 pht007,
          国企 pht008,
          民企 pht009,
          个体户 pht010,
          党政机关 pht011,
          事业单位 pht012,
          合作社 pht013,
          合计 pht014,
          社区工厂 pht015,
          就业扶贫基地 pht016,
          公岗小计 pht017,
          城镇公岗 pht018,
          公益专岗 pht019,
          特设公岗 pht020,
          苏陕协作 pht021,
          在苏就业 pht022,
          在陕就业 pht023,
          易地搬迁 pht024
     from (
           
           select xzqhmc,
                   sort,
                   转移就业总数,
                   镇内,
                   镇外县内,
                   县外市内,
                   市外省内,
                   省外,
                   国外,
                   国企,
                   民企,
                   个体户,
                   党政机关,
                   事业单位,
                   合作社,
                   合计,
                   社区工厂,
                   就业扶贫基地,
                   公岗小计,
                   城镇公岗,
                   公益专岗,
                   特设公岗,
                   苏陕协作,
                   在苏就业,
                   在陕就业,
                   易地搬迁
           
             from (select xzqhmc,
                           sort,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 转移就业总数,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys012 = '1'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 镇内,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys012 = '2'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 镇外县内,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys012 = '3'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 县外市内,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys012 = '4'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 市外省内,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys012 = '5'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 省外,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys012 = '6'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 国外,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys007 = '001'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 国企,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys007 = '002'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 民企,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys007 = '003'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 个体户,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys007 = '004'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 党政机关,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys007 = '005'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 事业单位,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys007 = '006'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 合作社,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 is not null
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 合计,
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '1'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 社区工厂,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '2'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 就业扶贫基地,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and (eys011 = '5' or eys011 = '6' or
                                           eys011 = '7')
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 公岗小计,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '6'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 城镇公岗,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '5'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 公益专岗,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '7'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 特设公岗,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and (eys011 = '3' or eys011 = '4')
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 苏陕协作,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '3'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 在苏就业,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from EMPLOYMENT_SITUATION s
                                     where s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '4'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 在陕就业,
                           
                           (select count(1)
                              from (select s.eys001,
                                           
                                           row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                      from poor_households      p,
                                           poor_labor_force     l,
                                           EMPLOYMENT_SITUATION s
                                     where p.phd001 = l.plf002
                                       and l.plf001 = s.eys002
                                       and phd013 = '1'
                                       and PLF011 = '2'
                                       and s.aae100 = '1'
                                       <if test="phd012 != null and phd012 !='' " >
            and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
        </if>
                                       and eys011 = '4'
                                       and s.aab301 like
                                           substr(c.xzqhbm, 0, #{len1}) || '%')
                            
                             where sn = 1
                            
                            ) 易地搬迁
                    
                      from poor_xzqh c
                     where fxzqhbm = #{aab301,jdbcType=VARCHAR}))
           
           union
           select xzqhmc,
                              sort,
                              转移就业总数,
                              镇内,
                              镇外县内,
                              县外市内,
                              市外省内,
                              省外,
                              国外,
                              国企,
                              民企,
                              个体户,
                              党政机关,
                              事业单位,
                              合作社,
                              合计,
                              社区工厂,
                              就业扶贫基地,
                              公岗小计,
                              城镇公岗,
                              公益专岗,
                              特设公岗,
                              苏陕协作,
                              在苏就业,
                              在陕就业,
                              易地搬迁
                      
                        from (select xzqhmc,
                                      sort,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 转移就业总数,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys012 = '1'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 镇内,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys012 = '2'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 镇外县内,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys012 = '3'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 县外市内,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys012 = '4'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 市外省内,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys012 = '5'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 省外,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys012 = '6'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 国外,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys007 = '001'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 国企,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys007 = '002'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 民企,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys007 = '003'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 个体户,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys007 = '004'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 党政机关,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys007 = '005'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 事业单位,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys007 = '006'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 合作社,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 is not null
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 合计,
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '1'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 社区工厂,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '2'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 就业扶贫基地,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and (eys011 = '5' or eys011 = '6' or
                                                      eys011 = '7')
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 公岗小计,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '6'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 城镇公岗,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '5'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 公益专岗,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '7'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 特设公岗,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and (eys011 = '3' or eys011 = '4')
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 苏陕协作,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '3'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 在苏就业,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from EMPLOYMENT_SITUATION s
                                                where s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '4'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 在陕就业,
                                      
                                      (select count(1)
                                         from (select s.eys001,
                                                      
                                                      row_number() over(partition by s.eys002 order by eys009 desc) as sn
                                                 from poor_households      p,
                                                      poor_labor_force     l,
                                                      EMPLOYMENT_SITUATION s
                                                where p.phd001 = l.plf002
                                                  and l.plf001 = s.eys002
                                                  and phd013 = '1'
                                                  and PLF011 = '2'
                                                  and s.aae100 = '1'
                                                  <if test="phd012 != null and phd012 !='' " >
                       and substr(eys009, 0, 4)  = #{phd012,jdbcType=VARCHAR}
                   </if>
                                                  and eys011 = '4'
                                                  and s.aab301 like
                                                      substr(c.xzqhbm, 0, #{len2}) || '%')
                                       
                                        where sn = 1
                                       
                                       ) 易地搬迁
                               
                                 from poor_xzqh c
                                where xzqhbm = #{aab301,jdbcType=VARCHAR}))
           )
    order by sort



####删除就业数据
begin for cc in (
    select eys001
    from EMPLOYMENT_SITUATION e
             right join (select plf.PLF001 plf001
                         from LAODONGLI l
                                  left join POOR_LABOR_FORCE plf on l.ID = plf.PLF005) pl on e.EYS002 = pl.plf001
    )
    loop
     update EMPLOYMENT_SITUATION set AAE100='0',DELETEDATE=SYSDATE,DELETEBY='薛鳌' where eys001=cc.eys001;
  end loop ;
   end;


   ####删除创业信息
   begin for cc in (
       select EPP001
       from ENTREPRENEURSHIP e
                right join (select plf.PLF001 plf001
                            from LAODONGLI l
                                     left join POOR_LABOR_FORCE plf on l.ID = plf.PLF005) pl on e.EPP002 = pl.plf001
       )
       loop
        update ENTREPRENEURSHIP set AAE100='0',DELETEDATE=SYSDATE,DELETEBY='薛鳌' where EPP001=cc.EPP001;
     end loop ;
      end;


#####删除培训信息
begin for cc in (
    select tsn001
    from TRAINING_SITUATION t
             right join (select plf.PLF001 plf001
                         from LAODONGLI l
                                  left join POOR_LABOR_FORCE plf on l.ID = plf.PLF005) pl on t.tsn010 = pl.plf001
    )
    loop
     update TRAINING_SITUATION set AAE100='0',DELETEDATE=SYSDATE,DELETEBY='薛鳌' where tsn001=cc.tsn001;
  end loop ;
   end;


   ####删除技工院校
   begin for cc in (
       select ths001
       from TECHNICAL_SCHOOLS t
                right join (select plf.PLF001 plf001
                            from LAODONGLI l
                                     left join POOR_LABOR_FORCE plf on l.ID = plf.PLF005) pl on t.ths002 = pl.plf001
       )
       loop
        update TECHNICAL_SCHOOLS set AAE100='0',DELETEDATE=SYSDATE,DELETEBY='薛鳌' where ths001=cc.ths001;
     end loop ;
      end;


######删除劳动力
      begin for cc in (
      select plf.PLF001 plf001 from LAODONGLI l left join POOR_LABOR_FORCE plf on l.ID = plf.PLF005)
      loop
          update POOR_LABOR_FORCE set AAE100='0',DELETEDATE=SYSDATE,DELETEBY='薛鳌' where plf001=cc.plf001;
          end loop;
      end;


####根据贫困户aab301  给 劳动力刷aab301
begin for cc in (
  select p.AAB301,plf.PLF002 from POOR_LABOR_FORCE plf left join  POOR_HOUSEHOLDS p on plf.PLF002 = p.PHD001 where plf.AAB301 is null and plf.AAE100='1'
)
loop
  update POOR_LABOR_FORCE set AAB301=cc.AAB301 where plf002=cc.PLF002;
  end loop ;
  end ;


####紫阳根据劳动力aab301 刷就业表aab301
begin for cc in (
select PLF001,plf.AAB301 from EMPLOYMENT_SITUATION es left join POOR_LABOR_FORCE plf on es.EYS002=plf.PLF001 where plf.AAB301 like '610924%'
    )
    loop
    update POOR_LABOR_FORCE set UPDATEBY='唐显丽',UPDATEDATE=SYSDATE,AAB301=cc.AAB301 where PLF001=cc.PLF001;

    end loop;
end;


###刷行政区划
begin
    for cc in (select s.AAB301, PLF001
               from POOR_LABOR_FORCE p,
                    POOR_HOUSEHOLDS s
               where p.PLF002 = s.PHD001)
        loop
            update POOR_LABOR_FORCE set AAB301 =cc.AAB301 where PLF001 = cc.PLF001;
            update EMPLOYMENT_SITUATION set AAB301 =cc.AAB301 where EYS002 = cc.PLF001;
        end loop;