#######贫困户统计
~~~sql
begin
  for cc in (select c.xzqhbm,
                    c.xzqhmc,
                    c.总户数,
                    c.总劳动力数,
                    c. 有贫困劳动力户数,
                    c.有转移就业意愿,
                    c.有创业意愿,
                    c.转移就业,
                    c.自主创业,
                    c.最少就业一人的贫困户
             
               from (select d.xzqhmc xzqhmc,
                            nvl((SELECT sum(count(a.aab301)) cun1
                                  FROM recursion r, POOR_HOUSEHOLDS a
                                 where r.aab301 = a.aab301
                                   and a.aae100 = '1'
                                   and d.xzqhbm = r.parentid
                                 group by a.aab301),
                                0) 总户数,
                            nvl((SELECT sum(count(a.plf001)) cun2
                                  FROM recursion r, poor_labor_force a
                                 where r.aab301 = a.aab301
                                   and a.aae100 = '1'
                                   and (plf018 in ('01', '02', '05') or
                                       plf018 is null)
                                   and (plf008 >= 16 and plf008 < 60)
                                   and d.xzqhbm = r.parentid
                                 group by a.aab301),
                                0) 总劳动力数,
                            nvl((SELECT sum(count(1)) cun1
                                  FROM recursion r, POOR_HOUSEHOLDS a
                                 where r.aab301 = a.aab301
                                   and a.aae100 = '1'
                                   and d.xzqhbm = r.parentid
                                   AND A.PHD008 > 0
                                 group by a.aab301),
                                0) 有贫困劳动力户数,
                            
                            nvl((SELECT sum(count(a.plf001)) cun2
                                  FROM recursion r, poor_labor_force a
                                 where r.aab301 = a.aab301
                                   and a.aae100 = '1'
                                   and (plf018 in ('01', '02', '05') or
                                       plf018 is null)
                                   and (plf008 >= 16 and plf008 < 60)
                                   and plf010 = '1'
                                   and d.xzqhbm = r.parentid
                                 group by a.aab301),
                                0) 有转移就业意愿,
                            nvl((SELECT sum(count(a.plf001)) cun2
                                  FROM recursion r, poor_labor_force a
                                 where r.aab301 = a.aab301
                                   and a.aae100 = '1'
                                   and (plf018 in ('01', '02', '05') or
                                       plf018 is null)
                                   and (plf008 >= 16 and plf008 < 60)
                                   and plf010 = '2'
                                   and d.xzqhbm = r.parentid
                                 group by a.aab301),
                                0) 有创业意愿,
                            
                            nvl((SELECT sum(count(a.plf001)) cun2
                                  FROM recursion r, poor_labor_force a
                                 where r.aab301 = a.aab301
                                   and a.aae100 = '1'
                                   and (plf018 in ('01', '02', '05') or
                                       plf018 is null)
                                   and (plf008 >= 16 and plf008 < 60)
                                   and (plf011 = '2' or plf011 = '4')
                                   and d.xzqhbm = r.parentid
                                 group by a.aab301),
                                0) 转移就业,
                            
                            nvl((SELECT sum(count(a.plf001)) cun2
                                  FROM recursion r, poor_labor_force a
                                 where r.aab301 = a.aab301
                                   and a.aae100 = '1'
                                   and (plf018 in ('01', '02', '05') or
                                       plf018 is null)
                                   and (plf008 >= 16 and plf008 < 60)
                                   and plf011 = '5'
                                   and d.xzqhbm = r.parentid
                                 group by a.aab301),
                                0) 自主创业,
                            
                            nvl((select count(plf001)
                                  from (SELECT r.aab301,
                                               d.plf001,
                                               row_number() over(partition by d.plf002 order by aae036 desc) as sn
                                          FROM recursion r, poor_labor_force d
                                         where r.aab301 = d.aab301
                                           and d.aae100 = '1'
                                           and (plf011 = '2' or plf011 = '4')
                                           and d.xzqhbm = r.parentid)
                                 where sn = 1),
                                0) 最少就业一人的贫困户
                       from poor_xzqh d
                     
                     ) c) loop
  
    INSERT INTO poor_household_translation
      (AAB301,
       xzqhmc,
       pht001,
       pht002,
       pht003,
       pht004,
       pht005,
       pht006,
       pht007,
       pht008)
      select cc.xzqhbm,
             cc.xzqhmc,
             cc.总户数,
             cc.总劳动力数,
             cc. 有贫困劳动力户数,
             cc.有转移就业意愿,
             cc.有创业意愿,
             cc.转移就业,
             cc.自主创业,
             cc.最少就业一人的贫困户
        from dual;
  
  end loop;

~~~

#####省
~~~sql
select xzqhmc,原始数据,确认数据,to_char(round(确认数据/原始数据,4)*100.00,'fm90.09')||'%' 确认率,待确认户,待确认劳动力 from (


select xzqhmc,
       (select count(1)
          from poor_households d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1'
           and c.xzqhbm = a.parentid) +
       (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1' and (plf008 between 16  and 60)  and plf018 in('01','02','05')
           and c.xzqhbm = a.parentid)原始数据,
            (select count(1)
          from poor_households d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1' and (d.createby is not null or d.updatedate is not null)
           and c.xzqhbm = a.parentid) +
       (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301  
           and aae100 = '1' and (d.createby is not null or d.updatedate is not null) and (plf008 between 16  and 60) and plf018 in('01','02','05')
           and c.xzqhbm = a.parentid) 确认数据,
            (select count(1)
          from poor_households d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1' and d.createby is  null and d.updatedate is  null
           and c.xzqhbm = a.parentid) 待确认户,
            (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301 and (plf008 between 16  and 60) a and plf018 in('01','02','05')
           and aae100 = '1' and d.createby is  null and d.updatedate is  null
           and c.xzqhbm = a.parentid)待确认劳动力
  from poor_xzqh c
      
 where type = '2' and xzqhbm!='611100000000'
 order by c.sort )

~~~

####就业

~~~sql
select c.xzqhmc,
       (select sum(count(1))
          from EMPLOYMENT_SITUATION d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1'
           and c.xzqhbm = a.parentid
         group by d.eys002, eys009
        having substr(eys009, 0, 4) = '2019') 就业数量,

       (select sum(count(1))
          from ENTREPRENEURSHIP d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1'
           and c.xzqhbm = a.parentid
         group by d.epp002, epp006
        having substr(epp006, 0, 4) = '2019') 创业数量,

         (select sum(count(1))
               from TRAINING_SITUATION d, recursion a
              where a.aab301 = d.aab301
                and aae100 = '1'
                and tsn003 in ('1','2','3')
                and c.xzqhbm = a.parentid
              group by d.tsn010, tsn007
             having substr(tsn007, 0, 4) = '2019') 技能培训,
            (select sum(count(1))
               from TRAINING_SITUATION d, recursion a
              where a.aab301 = d.aab301
                and aae100 = '1'
                and tsn003='4'
                and c.xzqhbm = a.parentid
              group by d.tsn010, tsn007
             having substr(tsn007, 0, 4) = '2019') 创业培训

  from poor_xzqh c
 where type = '2'
   and xzqhbm != '611100000000'
 order by c.sort;

~~~


#####劳动力统计
~~~sql
select xzqhmc,原始数据,确认数据,to_char(round(确认数据/原始数据,4)*100.00,'fm90.09')||'%' 确认率,待确认劳动力 from (select xzqhmc,
      
       (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1' and (plf008 between 16  and 60) and plf018 in('01','02','05')
           and c.xzqhbm = a.parentid)原始数据,
           
       (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301  
           and aae100 = '1' and (d.createby is not null or d.updatedate is not null) and (plf008 between 16  and 60)and plf018 in('01','02','05')
           and c.xzqhbm = a.parentid) 确认数据,
            (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301 and (plf008 between 16  and 60) and plf018 in('01','02','05')
           and aae100 = '1' and d.createby is  null and d.updatedate is  null
           and c.xzqhbm = a.parentid)待确认劳动力
  from poor_xzqh c    
 where (fxzqhbm='610000000000' or xzqhbm='610000000000') and xzqhbm!='611100000000' 
 order by c.sort )
~~~


~~~sql
select *
  from (select d.xzqhbm,
               d.xzqhmc xzqhmc,
               d.fxzqhbm,
               nvl((SELECT sum(count(a.aab301)) cun1
                     FROM recursion r, POOR_HOUSEHOLDS a
                    where r.aab301 = a.aab301
                      and a.aae100 = '1'
                      and d.xzqhbm = r.parentid
                    group by a.aab301),
                   0) 总户数,
               nvl((SELECT sum(count(1)) cun1
                     FROM recursion r, POOR_HOUSEHOLDS a
                    where r.aab301 = a.aab301
                      and a.aae100 = '1'
                      and d.xzqhbm = r.parentid
                      AND A.PHD008 > 0
                    group by a.aab301),
                   0) 有贫困劳动力户数,
               nvl((select count(plf001)
                     from (SELECT r.aab301,
                                  d.plf001,
                                  row_number() over(partition by d.plf002 order by aae036 desc) as sn
                             FROM recursion r, poor_labor_force d
                            where r.aab301 = d.aab301
                              and d.aae100 = '1'
                              and (plf011 = '2' or plf011 = '4')
                              and d.xzqhbm = r.parentid)
                    where sn = 1),
                   0) 最少就业一人的贫困户,
               
               nvl ((SELECT sum(count(phd001)) cun2
                      FROM recursion r, poor_labor_force a, poor_households h
                     where r.aab301 = a.aab301
                       and a.plf002 = h.phd001
                       and a.aae100 = '1'
                       and (plf018 in ('01', '02', '05') or plf018 is null)
                       and (plf008 >= 16 and plf008 < 60)
                       and (plf010 = '2' or plf010 = '1')
                       and d.xzqhbm = r.parentid
                     group by a.aab301, phd001),
               0) 有就创业意愿户数,
       
       nvl((SELECT sum(count(a.plf001)) cun2
             FROM recursion r, poor_labor_force a
            where r.aab301 = a.aab301
              and a.aae100 = '1'
              and (plf018 in ('01', '02', '05') or plf018 is null)
              and (plf008 >= 16 and plf008 < 60)
              and d.xzqhbm = r.parentid
            group by a.aab301),
           0) 贫困劳动力,
       
       nvl((SELECT sum(count(a.plf001)) cun2
             FROM recursion r, poor_labor_force a, EMPLOYMENT_SITUATION e
            where r.aab301 = a.aab301
              and a.plf001 = e.eys002
              and e.aae100 = '1'
              and e.eys004 = '1'
              and d.xzqhbm = r.parentid
              and substr(eys009, 0, 4) = '2019'
            group by a.aab301, a.plf001),
           0) 转移就业,
       nvl((SELECT sum(count(a.plf001)) cun2
             FROM recursion r, poor_labor_force a, EMPLOYMENT_SITUATION e
            where r.aab301 = a.aab301
              and a.plf001 = e.eys002
              and e.aae100 = '1'
              and e.eys004 = '3'
              and d.xzqhbm = r.parentid
              and substr(eys009, 0, 4) = '2019'
            group by a.aab301, a.plf001),
           0) 农业就业,
       
       nvl((SELECT sum(count(a.plf001)) cun2
             FROM recursion r, poor_labor_force a, ENTREPRENEURSHIP e
            where r.aab301 = a.aab301
              and a.plf001 = e.epp002
              and e.aae100 = '1'
              and substr(epp006, 0, 4) = '2019'
              and d.xzqhbm = r.parentid
            group by a.aab301, a.plf001),
           0) 自主创业,
       nvl ((SELECT sum(count(plf001)) cun2
              FROM recursion r, poor_labor_force a
             where r.aab301 = a.aab301
               and a.aae100 = '1'
               and (plf018 in ('01', '02', '05') or plf018 is null)
               and (plf008 >= 16 and plf008 < 60)
               and (plf010 = '2' or plf010 = '1')
               and d.xzqhbm = r.parentid
             group by a.aab301),
       0) 有就创业意愿人数,

nvl((SELECT sum(count(a.plf001)) cun2
       FROM recursion r, poor_labor_force a, TRAINING_SITUATION e
      where r.aab301 = a.aab301
        and a.plf001 = e.tsn010
        and e.aae100 = '1'
        and substr(tsn007, 0, 4) = '2019'
        and tsn003 != '4'
        and d.xzqhbm = r.parentid
      group by a.aab301, a.plf001), 0) 技能培训

  from poor_xzqh d where fxzqhbm='610000000000' or xzqhbm='610000000000' order by  d.sort)

~~~

~~~sql
select a.AAB301, a.PHT001, b. pht002
        
          from (select d.xzqhmc AAB301,
                       nvl((SELECT sum(count(a.aab301)) cun1
                             FROM POOR_HOUSEHOLDS a
                            where a.aae100 = '1'
                              and a.aab301 like substr(d.xzqhbm, 0, 4) || '%'
                            group by a.aab301),
                           0) pht001
                
                  from poor_xzqh d
                 where fxzqhbm = '610000000000'
                    or xzqhbm = '610000000000'
                 order by d.sort) a,
               (select d.xzqhmc AAB301,
                       nvl((SELECT sum(count(1)) cun1
                             FROM POOR_HOUSEHOLDS a
                            where a.aae100 = '1'
                              and a.aab301 like substr(d.xzqhbm, 0, 4) || '%'
                              AND A.PHD008 > 0
                            group by a.aab301),
                           0) pht002
                
                  from poor_xzqh d
                 where fxzqhbm = '610000000000'
                    or xzqhbm = '610000000000'
                 order by d.sort) b
 where a.aab301 = b.aab301

~~~

~~~sql


select * from (select AAB301, PHT001,''PHT002

  from (select d.xzqhmc AAB301,
               nvl((SELECT sum(count(a.aab301)) cun1
                     FROM recursion r, POOR_HOUSEHOLDS a
                    where r.aab301 = a.aab301
                      and a.aae100 = '1'
                      and d.xzqhbm = r.parentid
                    group by a.aab301),
                   0) pht001
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)
union all

select AAB301,''PHT001 , PHT002

  from (select d.xzqhmc AAB301,
               nvl((SELECT sum(count(1)) cun1
                     FROM recursion r, POOR_HOUSEHOLDS a
                    where r.aab301 = a.aab301
                      and a.aae100 = '1'
                      and d.xzqhbm = r.parentid
                      AND A.PHD008 > 0
                    group by a.aab301),
                   0) pht002
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)
union all

select AAB301, PHT002

  from (select d.xzqhmc AAB301,
               nvl((SELECT sum(count(1)) cun1
                     FROM recursion r, POOR_HOUSEHOLDS a
                    where r.aab301 = a.aab301
                      and a.aae100 = '1'
                      and d.xzqhbm = r.parentid
                      AND A.PHD008 > 0
                    group by a.aab301),
                   0) pht002
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)

union all

select AAB301, PHT003

  from (select d.xzqhmc AAB301,
               
               nvl((select count(plf001)
                     from (SELECT r.aab301,
                                  d.plf001,
                                  row_number() over(partition by a.phd001 order by a.aae036 desc) as sn
                             FROM recursion        r,
                                  poor_labor_force d,
                                  POOR_HOUSEHOLDS  a
                            where r.aab301 = d.aab301
                              and d.plf002 = a.phd001
                              and d.aae100 = '1'
                              and (plf011 = '2' or plf011 = '4')
                              and d.xzqhbm = r.parentid)
                    where sn = 1),
                   0) pht003
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)

union all

select AAB301, PHT004

  from (select d.xzqhmc AAB301,
               
               nvl((SELECT sum(count(phd001)) cun2
                     FROM recursion r, poor_labor_force a, poor_households h
                    where r.aab301 = a.aab301
                      and a.plf002 = h.phd001
                      and a.aae100 = '1'
                      and (plf018 in ('01', '02', '05') or plf018 is null)
                      and (plf008 >= 16 and plf008 < 60)
                      and (plf010 = '2' or plf010 = '1')
                      and d.xzqhbm = r.parentid
                    group by a.aab301, phd001),
                   0) pht004
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)

union all

select AAB301, PHT005

  from (select d.xzqhmc AAB301,
               
               nvl((SELECT sum(count(a.plf001)) cun2
                     FROM recursion r, poor_labor_force a, poor_households h
                    where r.aab301 = a.aab301
                      and a.plf002 = h.phd001
                      and a.aae100 = '1'
                      and (plf018 in ('01', '02', '05') or plf018 is null)
                      and (plf008 >= 16 and plf008 < 60)
                      and d.xzqhbm = r.parentid
                    group by a.aab301),
                   0) pht005
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)
union all

select AAB301, PHT006

  from (select d.xzqhmc AAB301,
               
               nvl((SELECT sum(count(a.plf001)) cun2
                     FROM recursion            r,
                          poor_labor_force     a,
                          EMPLOYMENT_SITUATION e,
                          poor_households      h
                    where r.aab301 = a.aab301
                      and a.plf002 = h.phd001
                      and a.plf001 = e.eys002
                      and e.aae100 = '1'
                      and e.eys004 = '1'
                      and d.xzqhbm = r.parentid
                   
                    group by a.aab301, a.plf001),
                   0) pht006
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)
union all

select AAB301, PHT007

  from (select d.xzqhmc AAB301,
               
               nvl((SELECT sum(count(a.plf001)) cun2
                     FROM recursion            r,
                          poor_labor_force     a,
                          EMPLOYMENT_SITUATION e,
                          poor_households      h
                    where r.aab301 = a.aab301
                      and a.plf002 = h.phd001
                      and a.plf001 = e.eys002
                      and e.aae100 = '1'
                      and e.eys004 = '3'
                      and d.xzqhbm = r.parentid
                   
                    group by a.aab301, a.plf001),
                   0) pht007
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)
union all

select AAB301, PHT008

  from (select d.xzqhmc AAB301,
               
               nvl((SELECT sum(count(a.plf001)) cun2
                     FROM recursion        r,
                          poor_labor_force a,
                          ENTREPRENEURSHIP e,
                          poor_households  h
                    where r.aab301 = a.aab301
                      and a.plf002 = h.phd001
                      and a.plf001 = e.epp002
                      and e.aae100 = '1'
                      and d.xzqhbm = r.parentid
                   
                    group by a.aab301, a.plf001),
                   0) pht008
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)
union all

select AAB301, PHT009

  from (select d.xzqhmc AAB301,
               
               nvl((SELECT sum(count(plf001)) cun2
                     FROM recursion r, poor_labor_force a, poor_households h
                    where r.aab301 = a.aab301
                      and a.plf002 = h.phd001
                      and a.aae100 = '1'
                      and (plf018 in ('01', '02', '05') or plf018 is null)
                      and (plf008 >= 16 and plf008 < 60)
                      and (plf010 = '2' or plf010 = '1')
                      and d.xzqhbm = r.parentid
                    group by a.aab301),
                   0) pht009
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort)
union all

select AAB301, PHT010

  from (select d.xzqhmc AAB301,
               
               nvl((SELECT sum(count(a.plf001)) cun2
                     FROM recursion          r,
                          poor_labor_force   a,
                          TRAINING_SITUATION e,
                          poor_households    h
                    where r.aab301 = a.aab301
                      and a.plf002 = h.phd001
                      and a.plf001 = e.tsn010
                      and e.aae100 = '1'
                      and tsn003 != '4'
                      and d.xzqhbm = r.parentid
                   
                    group by a.aab301, a.plf001),
                   0) pht010
        
          from poor_xzqh d
         where fxzqhbm = '610000000000'
            or xzqhbm = '610000000000'
         order by d.sort))
         
         
         
         -----------------
         
         select xzqhbm,
                xzqhmc,
                fxzqhbm,
                总户数,
                有贫困劳动力户数,
                最少就业一人的贫困户,
                有就创业意愿户数,
                贫困劳动力,
                转移就业,
                农业就业,
                自主创业,
                有就创业意愿人数,
                技能培训
           from (
                 
                 select xzqhbm,
                         xzqhmc,
                         fxzqhbm,
                         sort,
                         总户数,
                         有贫困劳动力户数,
                         最少就业一人的贫困户,
                         有就创业意愿户数,
                         贫困劳动力,
                         转移就业,
                         农业就业,
                         自主创业,
                         有就创业意愿人数,
                         技能培训
                   from (select d.xzqhbm,
                                 d.xzqhmc xzqhmc,
                                 d.fxzqhbm,
                                 d.sort,
                                 nvl((SELECT sum(count(a.aab301)) cun1
                                       FROM POOR_HOUSEHOLDS a
                                      where a.aae100 = '1'
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                      group by a.aab301),
                                     0) 总户数,
                                 nvl((SELECT sum(count(1)) cun1
                                       FROM POOR_HOUSEHOLDS a
                                      where a.aae100 = '1'
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                        AND A.PHD008 > 0
                                      group by a.aab301),
                                     0) 有贫困劳动力户数,
                                 nvl((select count(plf001)
                                       from (SELECT d.plf001,
                                                    row_number() over(partition by d.plf002 order by aae036 desc) as sn
                                               FROM poor_labor_force d
                                              where d.aae100 = '1'
                                                and (plf011 = '2' or plf011 = '4')
                                                and d.aab301 like
                                                    substr(xzqhbm, 0, 4) || '%')
                                      where sn = 1),
                                     0) 最少就业一人的贫困户,
                                 
                                 nvl((SELECT sum(count(phd001)) cun2
                                       FROM poor_labor_force a, poor_households h
                                      where a.plf002 = h.phd001
                                        and a.aae100 = '1'
                                        and (plf018 in ('01', '02', '05') or
                                            plf018 is null)
                                        and (plf008 >= 16 and plf008 < 60)
                                        and (plf010 = '2' or plf010 = '1')
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                      group by a.aab301, phd001),
                                     0) 有就创业意愿户数,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a
                                      where a.aae100 = '1'
                                        and (plf018 in ('01', '02', '05') or
                                            plf018 is null)
                                        and (plf008 >= 16 and plf008 < 60)
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                      group by a.aab301),
                                     0) 贫困劳动力,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, EMPLOYMENT_SITUATION e
                                      where a.plf001 = e.eys002
                                        and e.aae100 = '1'
                                        and e.eys004 = '1'
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                        and substr(eys009, 0, 4) = '2019'
                                      group by a.aab301, a.plf001),
                                     0) 转移就业,
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, EMPLOYMENT_SITUATION e
                                      where a.plf001 = e.eys002
                                        and e.aae100 = '1'
                                        and e.eys004 = '3'
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                        and substr(eys009, 0, 4) = '2019'
                                      group by a.aab301, a.plf001),
                                     0) 农业就业,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, ENTREPRENEURSHIP e
                                      where a.plf001 = e.epp002
                                        and e.aae100 = '1'
                                        and substr(epp006, 0, 4) = '2019'
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                      group by a.aab301, a.plf001),
                                     0) 自主创业,
                                 nvl((SELECT sum(count(plf001)) cun2
                                       FROM poor_labor_force a
                                      where a.aae100 = '1'
                                        and (plf018 in ('01', '02', '05') or
                                            plf018 is null)
                                        and (plf008 >= 16 and plf008 < 60)
                                        and (plf010 = '2' or plf010 = '1')
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                      group by a.aab301),
                                     0) 有就创业意愿人数,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, TRAINING_SITUATION e
                                      where a.plf001 = e.tsn010
                                        and e.aae100 = '1'
                                        and substr(tsn007, 0, 4) = '2019'
                                        and tsn003 != '4'
                                        and a.aab301 like substr(xzqhbm, 0, 4) || '%'
                                      group by a.aab301, a.plf001),
                                     0) 技能培训
                          
                            from poor_xzqh d
                           where fxzqhbm = '610000000000'
                          
                           )
                 
                 union
                 
                  select xzqhbm,
                         xzqhmc,
                         fxzqhbm,
                         sort,
                         总户数,
                         有贫困劳动力户数,
                         最少就业一人的贫困户,
                         有就创业意愿户数,
                         贫困劳动力,
                         转移就业,
                         农业就业,
                         自主创业,
                         有就创业意愿人数,
                         技能培训
                   from (select d.xzqhbm,
                                 d.xzqhmc xzqhmc,
                                 d.fxzqhbm,
                                 d.sort,
                                 nvl((SELECT sum(count(a.aab301)) cun1
                                       FROM POOR_HOUSEHOLDS a
                                      where a.aae100 = '1'
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                      group by a.aab301),
                                     0) 总户数,
                                 nvl((SELECT sum(count(1)) cun1
                                       FROM POOR_HOUSEHOLDS a
                                      where a.aae100 = '1'
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                        AND A.PHD008 > 0
                                      group by a.aab301),
                                     0) 有贫困劳动力户数,
                                 nvl((select count(plf001)
                                       from (SELECT d.plf001,
                                                    row_number() over(partition by d.plf002 order by aae036 desc) as sn
                                               FROM poor_labor_force d
                                              where d.aae100 = '1'
                                                and (plf011 = '2' or plf011 = '4')
                                                and d.aab301 like
                                                    substr(xzqhbm,0,2) || '%')
                                      where sn = 1),
                                     0) 最少就业一人的贫困户,
                                 
                                 nvl((SELECT sum(count(phd001)) cun2
                                       FROM poor_labor_force a, poor_households h
                                      where a.plf002 = h.phd001
                                        and a.aae100 = '1'
                                        and (plf018 in ('01', '02', '05') or
                                            plf018 is null)
                                        and (plf008 >= 16 and plf008 < 60)
                                        and (plf010 = '2' or plf010 = '1')
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                      group by a.aab301, phd001),
                                     0) 有就创业意愿户数,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a
                                      where a.aae100 = '1'
                                        and (plf018 in ('01', '02', '05') or
                                            plf018 is null)
                                        and (plf008 >= 16 and plf008 < 60)
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                      group by a.aab301),
                                     0) 贫困劳动力,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, EMPLOYMENT_SITUATION e
                                      where a.plf001 = e.eys002
                                        and e.aae100 = '1'
                                        and e.eys004 = '1'
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                        and substr(eys009, 0, 4) = '2019'
                                      group by a.aab301, a.plf001),
                                     0) 转移就业,
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, EMPLOYMENT_SITUATION e
                                      where a.plf001 = e.eys002
                                        and e.aae100 = '1'
                                        and e.eys004 = '3'
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                        and substr(eys009, 0, 4) = '2019'
                                      group by a.aab301, a.plf001),
                                     0) 农业就业,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, ENTREPRENEURSHIP e
                                      where a.plf001 = e.epp002
                                        and e.aae100 = '1'
                                        and substr(epp006, 0, 4) = '2019'
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                      group by a.aab301, a.plf001),
                                     0) 自主创业,
                                 nvl((SELECT sum(count(plf001)) cun2
                                       FROM poor_labor_force a
                                      where a.aae100 = '1'
                                        and (plf018 in ('01', '02', '05') or
                                            plf018 is null)
                                        and (plf008 >= 16 and plf008 < 60)
                                        and (plf010 = '2' or plf010 = '1')
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                      group by a.aab301),
                                     0) 有就创业意愿人数,
                                 
                                 nvl((SELECT sum(count(a.plf001)) cun2
                                       FROM poor_labor_force a, TRAINING_SITUATION e
                                      where a.plf001 = e.tsn010
                                        and e.aae100 = '1'
                                        and substr(tsn007, 0, 4) = '2019'
                                        and tsn003 != '4'
                                        and a.aab301 like substr(xzqhbm,0,2) || '%'
                                      group by a.aab301, a.plf001),
                                     0) 技能培训
                          
                            from poor_xzqh d
                           where xzqhbm = '610000000000'
                          
                           ))
          order by sort


~~~

~~~sql
select xzqhmc aab301,
       f_tj_pht001(xzqhbm, '2', '', '', '') pht001,
       f_tj_pht002(xzqhbm, '2', '', '', '') pht002,
       f_tj_pht003(xzqhbm, '2', '', '', '') pht003,
       f_tj_pht004(xzqhbm, '2', '', '', '') pht004,
       f_tj_pht005(xzqhbm, '2', '', '', '') pht005,
       f_tj_pht006(xzqhbm, '2', '', '', '') pht006,
       f_tj_pht007(xzqhbm, '2', '', '', '') pht007,
       f_tj_pht008(xzqhbm, '2', '', '', '') pht008,
       f_tj_pht009(xzqhbm, '2', '', '', '') pht009,
       f_tj_pht010(xzqhbm, '2', '', '', '') pht010
  from poor_xzqh
 where fxzqhbm = '610000000000' 
union all

select xzqhmc aab301,
       f_tj_pht001(xzqhbm, '1', '', '', '') pht001,
       f_tj_pht002(xzqhbm, '1', '', '', '') pht002,
       f_tj_pht003(xzqhbm, '1', '', '', '') pht003,
       f_tj_pht004(xzqhbm, '1', '', '', '') pht004,
       f_tj_pht005(xzqhbm, '1', '', '', '') pht005,
       f_tj_pht006(xzqhbm, '1', '', '', '') pht006,
       f_tj_pht007(xzqhbm, '1', '', '', '') pht007,
       f_tj_pht008(xzqhbm, '1', '', '', '') pht008,
       f_tj_pht009(xzqhbm, '1', '', '', '') pht009,
       f_tj_pht010(xzqhbm, '1', '', '', '') pht010
  from poor_xzqh
 where xzqhbm = '610000000000' 



~~~

####省汇报
~~~sql
select xzqhmc,原始户,确认户,to_char(round(确认户/原始户,4)*100.00,'fm90.09')||'%' 户确认率,待确认户,原始数据,确认数据,to_char(round(确认数据/原始数据,4)*100.00,'fm90.09')||'%' 确认率,待确认劳动力 from (select xzqhmc,
      
       (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1' and plf008>=  16  and plf008<  60 and plf018 in('01','02','05')
           and c.xzqhbm = a.parentid)原始数据,
           
       (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301  
           and aae100 = '1' and (d.createby is not null or d.updateby is not null) and plf008>=  16  and plf008<  60 and plf018 in('01','02','05')
           and c.xzqhbm = a.parentid) 确认数据,
            (select count(1)
          from poor_labor_force d, recursion a
         where a.aab301 = d.aab301 and plf008>=  16  and plf008<  60 and plf018 in('01','02','05')
           and aae100 = '1' and d.createby is  null and d.updateby is  null
           and c.xzqhbm = a.parentid)待确认劳动力,
             (select count(1)
          from poor_households d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1'
           and c.xzqhbm = a.parentid)原始户,
           (select count(1)
          from poor_households d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1' and (d.createby is not null or d.updateby is not null)
           and c.xzqhbm = a.parentid)确认户,
           
            (select count(1)
          from poor_households d, recursion a
         where a.aab301 = d.aab301
           and aae100 = '1' and d.createby is  null and d.updateby is  null
           and c.xzqhbm = a.parentid) 待确认户
           
  from poor_xzqh c    
 where  (fxzqhbm = '610000000000' or xzqhbm = '610000000000')
           and xzqhbm != '611100000000'
 order by c.sort)

~~~

###易地搬迁
~~~sql
select xzqhmc,
       转移就业,
       自主创业,
       技能培训,
       创业培训,
       苏陕协作转移就业,
       社区工厂,
       扶贫基地,
       城镇公岗,
       公益专岗数,
       特设公岗,
       苏陕协作培训,
       技工院校

  from (select xzqhmc,
               (select count(1)
                  from poor_households p, poor_labor_force l, recursion a
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   AND PLF011 = '2'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid
                
                ) 转移就业,
               (select count(1)
                  from poor_households p, poor_labor_force l, recursion a
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   AND PLF011 = '5'
                   and l.aae100 = '1'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid
                
                ) 自主创业,
               (select count(1)
                  from poor_households p, poor_labor_force l, recursion a
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   AND PLF024 = '1'
                   and l.aae100 = '1'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid
                
                ) 技能培训,
               (select count(1)
                  from poor_households p, poor_labor_force l, recursion a
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   AND PLF024 = '2'
                   and l.aae100 = '1'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid
                
                ) 创业培训,
               
               (select count(1)
                  from poor_households      p,
                       poor_labor_force     l,
                       EMPLOYMENT_SITUATION e,
                       recursion            a
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and (eys011 = '3' or eys011 = '4')
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid
                
                ) 苏陕协作转移就业,
               (select count(1)
                  from COMMUNITY_FACTORY p, recursion a
                 where aae100 = '1'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid
                   and ctf004 is not null) 社区工厂,
               (select count(1)
                  from POVERTY_ALLEVIATION_BASE p, recursion a
                 where aae100 = '1'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid
                   and pab013 is not null) 扶贫基地,
               (select count(1)
                  from poor_households      p,
                       poor_labor_force     l,
                       EMPLOYMENT_SITUATION e,
                       recursion            a
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and eys011 = '6'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid) 城镇公岗,
               (select count(1)
                  from poor_households      p,
                       poor_labor_force     l,
                       EMPLOYMENT_SITUATION e,
                       recursion            a
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and eys011 = '5'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid) 公益专岗数,
               (select count(1)
                  from poor_households      p,
                       poor_labor_force     l,
                       EMPLOYMENT_SITUATION e,
                       recursion            a
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and eys011 = '7'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid) 特设公岗,
               (select count(1)
                  from poor_households    p,
                       poor_labor_force   l,
                       TRAINING_SITUATION e,
                       recursion          a
                 where p.phd001 = l.plf002
                   and l.plf001 = e.tsn010
                   and e.aae100 = '1'
                   and tsn012 = '1'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid) 苏陕协作培训,
               
               (select count(1)
                  from poor_households   p,
                       poor_labor_force  l,
                       TECHNICAL_SCHOOLS e,
                       recursion         a
                 where p.phd001 = l.plf002
                   and l.plf001 = e.ths002
                   and e.aae100 = '1'
                   and p.aab301 = a.aab301
                   and c.xzqhbm = a.parentid) 技工院校
          from poor_xzqh c
         where (fxzqhbm = '610000000000' or xzqhbm = '610000000000')
           and xzqhbm != '611100000000'
         order by c.sort)

--------------------------------------------------------------------

select xzqhmc,
       转移就业,
       自主创业,
       技能培训,
       创业培训,
       苏陕协作转移就业,
       社区工厂,
       扶贫基地,
       城镇公岗,
       公益专岗数,
       特设公岗,
       苏陕协作培训,
       技工院校

  from (select xzqhmc,
               (select count(1)
                  from poor_households p, poor_labor_force l
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   and PLF011 = '2'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                
                ) 转移就业,
               (select count(1)
                  from poor_households p, poor_labor_force l
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   and PLF011 = '5'
                   and l.aae100 = '1'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                
                ) 自主创业,
               (select count(1)
                  from poor_households p, poor_labor_force l
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   and PLF024 = '1'
                   and l.aae100 = '1'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                
                ) 技能培训,
               (select count(1)
                  from poor_households p, poor_labor_force l
                 where p.phd001 = l.plf002
                   and phd013 = '1'
                   and PLF024 = '2'
                   and l.aae100 = '1'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                
                ) 创业培训,
               
               (select count(1)
                  from poor_households     p,
                       poor_labor_force    l,
                       EMPLOYMENT_SITUATION e
                
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and (eys011 = '3' or eys011 = '4')
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                
                ) 苏陕协作转移就业,
               (select count(1)
                  from COMMUNITY_FACTORY p
                 where aae100 = '1'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                   and ctf004 is not null) 社区工厂,
               (select count(1)
                  from POVERTY_ALLEVIATION_BASE p
                 where aae100 = '1'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                   and pab013 is not null) 扶贫基地,
               (select count(1)
                  from poor_households     p,
                       poor_labor_force    l,
                       EMPLOYMENT_SITUATION e
                
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and eys011 = '6'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 城镇公岗,
               (select count(1)
                  from poor_households     p,
                       poor_labor_force    l,
                       EMPLOYMENT_SITUATION e
                
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and eys011 = '5'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 公益专岗数,
               (select count(1)
                  from poor_households     p,
                       poor_labor_force    l,
                       EMPLOYMENT_SITUATION e
                
                 where p.phd001 = l.plf002
                   and l.plf001 = e.eys002
                   and e.aae100 = '1'
                   and eys011 = '7'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 特设公岗,
               (select count(1)
                  from poor_households  p,
                       poor_labor_force l,
                       TRAINING_SITUATION e
                
                 where p.phd001 = l.plf002
                   and l.plf001 = e.tsn010
                   and e.aae100 = '1'
                   and tsn012 = '1'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 苏陕协作培训,
               
               (select count(1)
                  from poor_households  p,
                       poor_labor_force l,
                       TECHNICAL_SCHOOLS e
                
                 where p.phd001 = l.plf002
                   and l.plf001 = e.ths002
                   and e.aae100 = '1'
                      
                   and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 技工院校
          from poor_xzqh c
         where fxzqhbm = '610000000000'
           and xzqhbm != '611100000000'
         order by c.sort)
         
    --------------------------------------------------------------------------     
         
         
         select xzqhmc,
                转移就业,
                自主创业,
                技能培训,
                创业培训,
                苏陕协作转移就业,
                社区工厂,
                扶贫基地,
                城镇公岗,
                公益专岗数,
                特设公岗,
                苏陕协作培训,
                技工院校 from(
         
         
         select xzqhmc,sort,
                转移就业,
                自主创业,
                技能培训,
                创业培训,
                苏陕协作转移就业,
                社区工厂,
                扶贫基地,
                城镇公岗,
                公益专岗数,
                特设公岗,
                苏陕协作培训,
                技工院校
         
           from (select xzqhmc,sort,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF011 = '2'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                         
                         ) 转移就业,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF011 = '5'
                            and l.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                         
                         ) 自主创业,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF024 = '1'
                            and l.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                         
                         ) 技能培训,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF024 = '2'
                            and l.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                         
                         ) 创业培训,
                        
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and (eys011 = '3' or eys011 = '4')
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                         
                         ) 苏陕协作转移就业,
                        (select count(1)
                           from COMMUNITY_FACTORY p
                          where aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                            and ctf004 is not null) 社区工厂,
                        (select count(1)
                           from POVERTY_ALLEVIATION_BASE p
                          where aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%'
                            and pab013 is not null) 扶贫基地,
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and eys011 = '6'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 城镇公岗,
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and eys011 = '5'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 公益专岗数,
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and eys011 = '7'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 特设公岗,
                        (select count(1)
                           from poor_households  p,
                                poor_labor_force l,
                                TRAINING_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.tsn010
                            and e.aae100 = '1'
                            and tsn012 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 苏陕协作培训,
                        
                        (select count(1)
                           from poor_households  p,
                                poor_labor_force l,
                                TECHNICAL_SCHOOLS e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.ths002
                            and e.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 4) || '%') 技工院校
                   from poor_xzqh c
                  where fxzqhbm = '610000000000'
                    and xzqhbm != '611100000000'
                 )
         union 
         
         select xzqhmc,sort,
                转移就业,
                自主创业,
                技能培训,
                创业培训,
                苏陕协作转移就业,
                社区工厂,
                扶贫基地,
                城镇公岗,
                公益专岗数,
                特设公岗,
                苏陕协作培训,
                技工院校
         
           from (select xzqhmc,sort,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF011 = '2'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%'
                         
                         ) 转移就业,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF011 = '5'
                            and l.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%'
                         
                         ) 自主创业,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF022 = '1'
                            and l.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%'
                         
                         ) 技能培训,
                        (select count(1)
                           from poor_households p, poor_labor_force l
                          where p.phd001 = l.plf002
                            and phd013 = '1'
                            and PLF022 = '2'
                            and l.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%'
                         
                         ) 创业培训,
                        
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and (eys011 = '3' or eys011 = '2')
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%'
                         
                         ) 苏陕协作转移就业,
                        (select count(1)
                           from COMMUNITY_FACTORY p
                          where aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%'
                            and ctf002 is not null) 社区工厂,
                        (select count(1)
                           from POVERTY_ALLEVIATION_BASE p
                          where aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%'
                            and pab013 is not null) 扶贫基地,
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and eys011 = '6'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%') 城镇公岗,
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and eys011 = '5'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%') 公益专岗数,
                        (select count(1)
                           from poor_households     p,
                                poor_labor_force    l,
                                EMPLOYMENT_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.eys002
                            and e.aae100 = '1'
                            and eys011 = '7'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%') 特设公岗,
                        (select count(1)
                           from poor_households  p,
                                poor_labor_force l,
                                TRAINING_SITUATION e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.tsn010
                            and e.aae100 = '1'
                            and tsn012 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%') 苏陕协作培训,
                        
                        (select count(1)
                           from poor_households  p,
                                poor_labor_force l,
                                TECHNICAL_SCHOOLS e
                         
                          where p.phd001 = l.plf002
                            and l.plf001 = e.ths002
                            and e.aae100 = '1'
                               
                            and p.aab301 like substr(c.xzqhbm, 0, 2) || '%') 技工院校
                   from poor_xzqh c
                  where xzqhbm = '610000000000'
                    
                  )
         )order by sort
~~~
